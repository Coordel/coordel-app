function _optimizeReleaseDirs(a,b,c,d,e,f){var g=d.releaseDir+"/"+a.replace(/\./g,"/"),h=d.profileProperties.dependencies.prefixes;d.internStrings&&(logger.info("Interning strings for: "+g),buildUtil.internTemplateStrings(d.profileProperties.dependencies,g,e)),buildUtil.processConditionalsForDir(g,e,d),i18nUtil.flattenDirBundles(a,b,d,f),d.loader=="xdomain"&&buildUtilXd.xdgen(a,b,h,e,d),buildUtil.optimizeJsDir(g,e,c,d.optimize,d.stripConsole),d.cssOptimize&&buildUtil.optimizeCss(g,d.cssOptimize,d.cssImportIgnore)}function _copyToRelease(a,b,c,d){var e=a.replace(/\./g,"/"),f=c.releaseDir+"/"+e,g={include:/./};c.copyTests||(g.exclude=/\/tests\//),c.mini&&(g.exclude=/\/tests\/|\/demos\/|tests\.js|dijit\/bench|dijit\/themes\/themeTest|(\.php$)/),logger.info("Copying: "+b+" to: "+f);var h=fileUtil.copyDir(b,f,g,!0);a=="dojo"&&c.query=="sizzle"&&fileUtil.copyFile(f+"/_base/query-sizzle.js",f+"/_base/query.js"),h||logger.info(" ********** Not Copied: "+b);if(d)for(n=0;n<d.length;n++){var i=d[n].replace(/\.\.\//g,"");if(i.indexOf(e)==0){var j=i.replace(e,"");i=b+j;if((new java.io.File(i)).exists()){var k=f+j;fileUtil.copyFile(i,k)}}}if(h){var l=!1,m=c.profileProperties.dependencies.layers;if(m)for(var n=0;n<m.length;n++)if(l=m[n].customBase)break;c.addGuards&&buildUtil.addGuardsAndBaseRequires(h,l)}}function release(){logger.info("Using profile: "+kwArgs.profileFile),logger.info("Using version number: "+kwArgs.version+" for the release."),kwArgs.buildLayers||clean();var a=kwArgs.profileProperties.dependencies,b=a.prefixes,c=fileUtil.getLineSeparator(),d=fileUtil.readFile(buildScriptsPath+"copyright.txt"),e=fileUtil.readFile(buildScriptsPath+"build_notice.txt"),f=buildUtil.getDojoPrefixPath(b),g=null;kwArgs.buildLayers&&(g=kwArgs.buildLayers.split(","));for(var h=0;h<b.length;h++){var i=b[h][0],j=b[h][1],k=j;k.indexOf(".")==0&&i!="dojo"&&(k=f+"/"+j),_copyToRelease(i,k,kwArgs,g);if(kwArgs.symbol){var l=kwArgs.releaseDir+"/"+i.replace(/\./g,"/");buildUtil.insertSymbols(l,kwArgs)}}for(h=0;h<b.length;h++)b[h][1]=kwArgs.releaseDir+"/"+b[h][0].replace(/\./g,"/");typeof dojo!="undefined"&&(dojo=undefined),logger.trace("Building dojo.js and layer files");var m=buildUtil.makeDojoJs(buildUtil.loadDependencyList(kwArgs.profileProperties,kwArgs,buildScriptsPath),kwArgs.version,kwArgs),n=d+e,o=kwArgs.releaseDir+"/dojo/",p="",q="";kwArgs.buildLayers&&(kwArgs.buildLayers+=",",kwArgs.buildLayers=kwArgs.buildLayers.replace(/\\/g,"/"));for(h=0;h<m.length;h++){var r=m[h],s=r.layerName,t=r.copyrightFile?fileUtil.readFile(r.copyrightFile):n,u=o+r.layerName,v=r.contents,w=s.replace(/\.\.\//g,""),x=w.replace(/\.js$/,"");p+=(p?"|":"")+buildUtil.regExpEscape(w)+"$",p+="|"+buildUtil.regExpEscape(w+".uncompressed.js")+"$",x.indexOf("/")!=-1&&(x=x.substring(x.lastIndexOf("/")+1,x.length)),q+=(q?"|":"")+buildUtil.regExpEscape(x);if(kwArgs.buildLayers&&kwArgs.buildLayers.indexOf(s+",")==-1)continue;kwArgs.scopeDjConfig&&(s.match(/dojo\.xd\.js$/)||s.match(/dojo\.js$/))&&(v=buildUtil.setScopeDjConfig(v,kwArgs.scopeDjConfig)),kwArgs.scopeMap&&(s.match(/dojo\.xd\.js$/)||s.match(/dojo\.js$/))&&(v=buildUtil.setScopeNames(v,kwArgs.scopeMap)),s=="dojo.xd.js"&&kwArgs.xdDojoPath&&(v=buildUtilXd.setXdDojoConfig(v,kwArgs.xdDojoPath)),v=i18nUtil.flattenLayerFileBundles(u,v,kwArgs);var y=u+".uncompressed.js",z=t+v;s.match(/\.xd\.js$/)&&!s.match(/dojo(\.xd)?\.js/)&&(z=buildUtilXd.makeXdContents(z,b,kwArgs)),fileUtil.saveUtf8File(y,z);if(kwArgs.internStrings){logger.info("Interning strings for file: "+u),b=a.prefixes||[];var A=a.internSkipList||[];buildUtil.internTemplateStringsInFile(y,o,b,A),v=fileUtil.readFile(y)}else v=z;logger.trace("Optimizing ("+kwArgs.layerOptimize+") file: "+u);var B=buildUtil.optimizeJs(u,v,t,kwArgs.layerOptimize,kwArgs.stripConsole);fileUtil.saveUtf8File(u,B)}var C="Files baked into this build:"+c;for(h=0;h<m.length;h++)C+=c+m[h].layerName+":"+c,C+=m[h].depList.join(c)+c;fileUtil.saveFile(kwArgs.releaseDir+"/dojo/build.txt",C),logger.info(C);var D=new RegExp("("+p+")"),E=new RegExp("\\/nls\\/("+q+")_");for(h=0;h<b.length;h++)d=null,b[h][2]&&(d=fileUtil.readFile(b[h][2])),kwArgs.buildLayers||_optimizeReleaseDirs(b[h][0],b[h][1],d,kwArgs,D,E);kwArgs.copyTests&&!kwArgs.mini&&fileUtil.copyDir("../doh",kwArgs.releaseDir+"/util/doh",/./),kwArgs.mini&&kwArgs.internStrings&&(fileUtil.deleteFile(kwArgs.releaseDir+"/dijit/templates"),fileUtil.deleteFile(kwArgs.releaseDir+"/dijit/form/templates"),fileUtil.deleteFile(kwArgs.releaseDir+"/dijit/layout/templates")),logger.info("Build is in directory: "+kwArgs.releaseDir)}function clean(){logger.info("Deleting: "+kwArgs.releaseDir),fileUtil.deleteFile(kwArgs.releaseDir)}function help(){var a="";for(var b in buildUtil.DojoBuildOptions)a+=b+"="+buildUtil.DojoBuildOptions[b].defaultValue+"\n"+buildUtil.DojoBuildOptions[b].helpText+"\n\n";var c="To run the build, you must have Java 1.4.2 or later installed.\nTo run a build run the following command from this directory:\n\n> java -classpath ../shrinksafe/js.jar:../shrinksafe/shrinksafe.jar org.mozilla.javascript.tools.shell.Main build.js [name=value...]\n\nHere is an example of a typical release build:\n\n> java -classpath ../shrinksafe/js.jar:../shrinksafe/shrinksafe.jar org.mozilla.javascript.tools.shell.Main  build.js profile=base action=release\n\nIf you get a 'java.lang.OutOfMemoryError: Java heap space' error, try increasing the memory Java can use for the command:\n\n> java -Xms256m -Xmx256m -classpath ../shrinksafe/js.jar:../shrinksafe/shrinksafe.jar org.mozilla.javascript.tools.shell.Main build.js profile=base action=release\n\nChange the 256 number to the number of megabytes you want to give Java.\n\nThe possible name=value build options are shown below with the defaults as their values:\n\n"+a;print(c)}var buildTimerStart=(new Date).getTime();buildScriptsPath=typeof buildScriptsPath=="undefined"?"./":buildScriptsPath,load(buildScriptsPath+"jslib/logger.js"),load(buildScriptsPath+"jslib/fileUtil.js"),load(buildScriptsPath+"jslib/buildUtil.js"),load(buildScriptsPath+"jslib/buildUtilXd.js"),load(buildScriptsPath+"jslib/i18nUtil.js");var kwArgs=buildUtil.makeBuildOptions(arguments);kwArgs.removeDefaultNameSpaces&&(delete com,delete net,delete org),logger.level=kwArgs.log;var action=kwArgs.action;for(var i=0;i<action.length;i++)logger.logPrefix=action[i]+": ",this[action[i]](),logger.logPrefix="";var buildTime=((new Date).getTime()-buildTimerStart)/1e3;logger.info("Build time: "+buildTime+" seconds")