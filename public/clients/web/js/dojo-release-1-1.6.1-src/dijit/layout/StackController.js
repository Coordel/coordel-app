define("dijit/layout/StackController",["dojo","dijit","dijit/_Widget","dijit/_Templated","dijit/_Container","dijit/form/ToggleButton","i18n!dijit/nls/common"],function(a,b){a.declare("dijit.layout.StackController",[b._Widget,b._Templated,b._Container],{templateString:"<span role='tablist' dojoAttachEvent='onkeypress' class='dijitStackController'></span>",containerId:"",buttonWidget:"dijit.layout._StackButton",constructor:function(){this.pane2button={},this.pane2connects={},this.pane2watches={}},buildRendering:function(){this.inherited(arguments),b.setWaiRole(this.domNode,"tablist")},postCreate:function(){this.inherited(arguments),this.subscribe(this.containerId+"-startup","onStartup"),this.subscribe(this.containerId+"-addChild","onAddChild"),this.subscribe(this.containerId+"-removeChild","onRemoveChild"),this.subscribe(this.containerId+"-selectChild","onSelectChild"),this.subscribe(this.containerId+"-containerKeyPress","onContainerKeyPress")},onStartup:function(b){a.forEach(b.children,this.onAddChild,this),b.selected&&this.onSelectChild(b.selected)},destroy:function(){for(var a in this.pane2button)this.onRemoveChild(b.byId(a));this.inherited(arguments)},onAddChild:function(c,d){var e=a.getObject(this.buttonWidget),f=new e({id:this.id+"_"+c.id,label:c.title,dir:c.dir,lang:c.lang,showLabel:c.showTitle,iconClass:c.iconClass,closeButton:c.closable,title:c.tooltip});b.setWaiState(f.focusNode,"selected","false");var g=["title","showTitle","iconClass","closable","tooltip"],h=["label","showLabel","iconClass","closeButton","title"];this.pane2watches[c.id]=a.map(g,function(a,b){return c.watch(a,function(a,c,d){f.set(h[b],d)})}),this.pane2connects[c.id]=[this.connect(f,"onClick",a.hitch(this,"onButtonClick",c)),this.connect(f,"onClickCloseButton",a.hitch(this,"onCloseButtonClick",c))],this.addChild(f,d),this.pane2button[c.id]=f,c.controlButton=f,this._currentChild||(f.focusNode.setAttribute("tabIndex","0"),b.setWaiState(f.focusNode,"selected","true"),this._currentChild=c),!this.isLeftToRight()&&a.isIE&&this._rectifyRtlTabList&&this._rectifyRtlTabList()},onRemoveChild:function(b){this._currentChild===b&&(this._currentChild=null),a.forEach(this.pane2connects[b.id],a.hitch(this,"disconnect")),delete this.pane2connects[b.id],a.forEach(this.pane2watches[b.id],function(a){a.unwatch()}),delete this.pane2watches[b.id];var c=this.pane2button[b.id];c&&(this.removeChild(c),delete this.pane2button[b.id],c.destroy()),delete b.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var c=this.pane2button[this._currentChild.id];c.set("checked",!1),b.setWaiState(c.focusNode,"selected","false"),c.focusNode.setAttribute("tabIndex","-1")}var d=this.pane2button[a.id];d.set("checked",!0),b.setWaiState(d.focusNode,"selected","true"),this._currentChild=a,d.focusNode.setAttribute("tabIndex","0");var e=b.byId(this.containerId);b.setWaiState(e.containerNode,"labelledby",d.id)}},onButtonClick:function(a){var c=b.byId(this.containerId);c.selectChild(a)},onCloseButtonClick:function(a){var c=b.byId(this.containerId);c.closeChild(a);if(this._currentChild){var d=this.pane2button[this._currentChild.id];d&&b.focus(d.focusNode||d.domNode)}},adjacent:function(b){!this.isLeftToRight()&&(!this.tabPosition||/top|bottom/.test(this.tabPosition))&&(b=!b);var c=this.getChildren(),d=a.indexOf(c,this.pane2button[this._currentChild.id]),e=b?1:c.length-1;return c[(d+e)%c.length]},onkeypress:function(b){if(!this.disabled&&!b.altKey){var c=null;if(b.ctrlKey||!b._djpage){var d=a.keys;switch(b.charOrCode){case d.LEFT_ARROW:case d.UP_ARROW:b._djpage||(c=!1);break;case d.PAGE_UP:b.ctrlKey&&(c=!1);break;case d.RIGHT_ARROW:case d.DOWN_ARROW:b._djpage||(c=!0);break;case d.PAGE_DOWN:b.ctrlKey&&(c=!0);break;case d.HOME:case d.END:var e=this.getChildren();e&&e.length&&e[b.charOrCode==d.HOME?0:e.length-1].onClick(),a.stopEvent(b);break;case d.DELETE:this._currentChild.closable&&this.onCloseButtonClick(this._currentChild),a.stopEvent(b);break;default:b.ctrlKey&&(b.charOrCode===d.TAB?(this.adjacent(!b.shiftKey).onClick(),a.stopEvent(b)):b.charOrCode=="w"&&(this._currentChild.closable&&this.onCloseButtonClick(this._currentChild),a.stopEvent(b)))}c!==null&&(this.adjacent(c).onClick(),a.stopEvent(b))}}},onContainerKeyPress:function(a){a.e._djpage=a.page,this.onkeypress(a.e)}}),a.declare("dijit.layout._StackButton",b.form.ToggleButton,{tabIndex:"-1",buildRendering:function(a){this.inherited(arguments),b.setWaiRole(this.focusNode||this.domNode,"tab")},onClick:function(a){b.focus(this.focusNode)},onClickCloseButton:function(a){a.stopPropagation()}});return b.layout.StackController})