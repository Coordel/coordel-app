define("dijit/Editor",["dojo","dijit","dijit/_editor/RichText","dijit/Toolbar","dijit/ToolbarSeparator","dijit/_editor/_Plugin","dijit/_editor/plugins/EnterKeyHandling","dijit/_editor/range","dijit/_Container","dojo/i18n","dijit/layout/_LayoutWidget","i18n!dijit/_editor/nls/commands"],function(a,b){a.declare("dijit.Editor",b._editor.RichText,{plugins:null,extraPlugins:null,constructor:function(){a.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull","dijit._editor.plugins.EnterKeyHandling"]),this._plugins=[],this._editInterval=this.editActionInterval*1e3,a.isIE&&(this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate"))},postMixInProperties:function(){this.setValueDeferred=new a.Deferred,this.inherited(arguments)},postCreate:function(){this._steps=this._steps.slice(0),this._undoedSteps=this._undoedSteps.slice(0),a.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins)),this.inherited(arguments),this.commands=a.i18n.getLocalization("dijit._editor","commands",this.lang),this.toolbar||(this.toolbar=new b.Toolbar({dir:this.dir,lang:this.lang}),this.header.appendChild(this.toolbar.domNode)),a.forEach(this.plugins,this.addPlugin,this),this.setValueDeferred.callback(!0),a.addClass(this.iframe.parentNode,"dijitEditorIFrameContainer"),a.addClass(this.iframe,"dijitEditorIFrame"),a.attr(this.iframe,"allowTransparency",!0),a.isWebKit&&a.style(this.domNode,"KhtmlUserSelect","none"),this.toolbar.startup(),this.onNormalizedDisplayChanged()},destroy:function(){a.forEach(this._plugins,function(a){a&&a.destroy&&a.destroy()}),this._plugins=[],this.toolbar.destroyRecursive(),delete this.toolbar,this.inherited(arguments)},addPlugin:function(c,d){var e=a.isString(c)?{name:c}:c;if(!e.setEditor){var f={args:e,plugin:null,editor:this};a.publish(b._scopeName+".Editor.getPlugin",[f]);if(!f.plugin){var g=a.getObject(e.name);g&&(f.plugin=new g(e))}if(!f.plugin){console.warn("Cannot find plugin",c);return}c=f.plugin}arguments.length>1?this._plugins[d]=c:this._plugins.push(c),c.setEditor(this),a.isFunction(c.setToolbar)&&c.setToolbar(this.toolbar)},startup:function(){},resize:function(a){a&&b.layout._LayoutWidget.prototype.resize.apply(this,arguments)},layout:function(){var b=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+a._getPadBorderExtents(this.iframe.parentNode).h+a._getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=b+"px",this.iframe&&(this.iframe.style.height="100%"),this._layoutMode=!0},_onIEMouseDown:function(b){var c,d=this.document.body,e=d.clientWidth,f=d.clientHeight,g=d.clientLeft,h=d.offsetWidth,i=d.offsetHeight,j=d.offsetLeft;bodyDir=d.dir?d.dir.toLowerCase():"",bodyDir!="rtl"?e<h&&b.x>e&&b.x<h&&(c=!0):b.x<g&&b.x>j&&(c=!0),c||f<i&&b.y>f&&b.y<i&&(c=!0),c||(delete this._cursorToStart,delete this._savedSelection,b.target.tagName=="BODY"&&setTimeout(a.hitch(this,"placeCursorAtEnd"),0),this.inherited(arguments))},onBeforeActivate:function(a){this._restoreSelection()},onBeforeDeactivate:function(a){this.customUndo&&this.endEditing(!0),a.target.tagName!="BODY"&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(b){this._inEditing||(this._inEditing=!0,this._beginEditing(b)),this.editActionInterval>0&&(this._editTimer&&clearTimeout(this._editTimer),this._editTimer=setTimeout(a.hitch(this,this.endEditing),this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(b){if(!this.customUndo||b!="undo"&&b!="redo"){this.customUndo&&(this.endEditing(),this._beginEditing());var c,d=/copy|cut|paste/.test(b);try{c=this.inherited(arguments);if(a.isWebKit&&d&&!c)throw{code:1011}}catch(e){if(e.code==1011&&d){var f=a.string.substitute,g={cut:"X",copy:"C",paste:"V"};alert(f(this.commands.systemShortcut,[this.commands[b],f(this.commands[a.isMac?"appleKey":"ctrlKey"],[g[b]])]))}c=!1}this.customUndo&&this._endEditing();return c}return this[b]()},queryCommandEnabled:function(a){return!this.customUndo||a!="undo"&&a!="redo"?this.inherited(arguments):a=="undo"?this._steps.length>1:this._undoedSteps.length>0},_moveToBookmark:function(c){var d=c.mark,e=c.mark,f=c.isCollapsed,g,h,i,j;e&&(a.isIE<9?a.isArray(e)?(d=[],a.forEach(e,function(a){d.push(b.range.getNode(a,this.editNode))},this),a.withGlobal(this.window,"moveToBookmark",b,[{mark:d,isCollapsed:f}])):e.startContainer&&e.endContainer&&(j=b.range.getSelection(this.window),j&&j.removeAllRanges&&(j.removeAllRanges(),g=b.range.create(this.window),h=b.range.getNode(e.startContainer,this.editNode),i=b.range.getNode(e.endContainer,this.editNode),h&&i&&(g.setStart(h,e.startOffset),g.setEnd(i,e.endOffset),j.addRange(g)))):(j=b.range.getSelection(this.window),j&&j.removeAllRanges&&(j.removeAllRanges(),g=b.range.create(this.window),h=b.range.getNode(e.startContainer,this.editNode),i=b.range.getNode(e.endContainer,this.editNode),h&&i&&(g.setStart(h,e.startOffset),g.setEnd(i,e.endOffset),j.addRange(g)))))},_changeToStep:function(a,b){this.setValue(b.text);var c=b.bookmark;c&&this._moveToBookmark(c)},undo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0,this.endEditing(!0);var b=this._steps.pop();b&&this._steps.length>0&&(this.focus(),this._changeToStep(b,this._steps[this._steps.length-1]),this._undoedSteps.push(b),this.onDisplayChanged(),delete this._undoRedoActive,a=!0),delete this._undoRedoActive}return a},redo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0,this.endEditing(!0);var b=this._undoedSteps.pop();b&&this._steps.length>0&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],b),this._steps.push(b),this.onDisplayChanged(),a=!0),delete this._undoRedoActive}return a},endEditing:function(a){this._editTimer&&clearTimeout(this._editTimer),this._inEditing&&(this._endEditing(a),this._inEditing=!1)},_getBookmark:function(){var c=a.withGlobal(this.window,b.getBookmark),d=[];if(c&&c.mark){var e=c.mark;if(a.isIE<9){var f=b.range.getSelection(this.window);if(a.isArray(e))a.forEach(c.mark,function(a){d.push(b.range.getIndex(a,this.editNode).o)},this),c.mark=d;else if(f){var g;f.rangeCount&&(g=f.getRangeAt(0)),g?c.mark=g.cloneRange():c.mark=a.withGlobal(this.window,b.getBookmark)}}try{c.mark&&c.mark.startContainer&&(d=b.range.getIndex(c.mark.startContainer,this.editNode).o,c.mark={startContainer:d,startOffset:c.mark.startOffset,endContainer:c.mark.endContainer===c.mark.startContainer?d:b.range.getIndex(c.mark.endContainer,this.editNode).o,endOffset:c.mark.endOffset})}catch(h){c.mark=null}}return c},_beginEditing:function(a){this._steps.length===0&&this._steps.push({text:b._editor.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(a){var c=b._editor.getChildrenHtml(this.editNode);this._undoedSteps=[],this._steps.push({text:c,bookmark:this._getBookmark()})},onKeyDown:function(b){!a.isIE&&!this.iframe&&b.keyCode==a.keys.TAB&&!this.tabIndent&&this._saveSelection();if(this.customUndo){var c=b.keyCode,d=a.keys;if(b.ctrlKey&&!b.altKey){if(c==90||c==122){a.stopEvent(b),this.undo();return}if(c==89||c==121){a.stopEvent(b),this.redo();return}}this.inherited(arguments);switch(c){case d.ENTER:case d.BACKSPACE:case d.DELETE:this.beginEditing();break;case 88:case 86:if(b.ctrlKey&&!b.altKey&&!b.metaKey){this.endEditing(),b.keyCode==88?(this.beginEditing("cut"),setTimeout(a.hitch(this,this.endEditing),1)):(this.beginEditing("paste"),setTimeout(a.hitch(this,this.endEditing),1));break};default:if(!b.ctrlKey&&!b.altKey&&!b.metaKey&&(b.keyCode<a.keys.F1||b.keyCode>a.keys.F15)){this.beginEditing();break};case d.ALT:this.endEditing();break;case d.UP_ARROW:case d.DOWN_ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.HOME:case d.END:case d.PAGE_UP:case d.PAGE_DOWN:this.endEditing(!0);break;case d.CTRL:case d.SHIFT:case d.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments),this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(a){}},_restoreSelection:function(){this._savedSelection&&(delete this._cursorToStart,a.withGlobal(this.window,"isCollapsed",b)&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0),this.inherited(arguments)},replaceValue:function(a){this.customUndo?this.isClosed?this.setValue(a):(this.beginEditing(),a||(a="&nbsp;"),this.setValue(a),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(b){var c=a.hitch(this,function(){!this.disabled&&b||!this._buttonEnabledPlugins&&b?a.forEach(this._plugins,function(a){a.set("disabled",!0)}):this.disabled&&!b&&a.forEach(this._plugins,function(a){a.set("disabled",!1)})});this.setValueDeferred.addCallback(c),this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&a.style(this.document.body,"color",a.style(this.iframe,"color"))}catch(b){}}}),a.subscribe(b._scopeName+".Editor.getPlugin",null,function(a){if(!a.plugin){var c=a.args,d,e=b._editor._Plugin,f=c.name;switch(f){case"undo":case"redo":case"cut":case"copy":case"paste":case"insertOrderedList":case"insertUnorderedList":case"indent":case"outdent":case"justifyCenter":case"justifyFull":case"justifyLeft":case"justifyRight":case"delete":case"selectAll":case"removeFormat":case"unlink":case"insertHorizontalRule":d=new e({command:f});break;case"bold":case"italic":case"underline":case"strikethrough":case"subscript":case"superscript":d=new e({buttonClass:b.form.ToggleButton,command:f});break;case"|":d=new e({button:new b.ToolbarSeparator,setEditor:function(a){this.editor=a}})}a.plugin=d}});return b.Editor})