define("dijit/Dialog",["dojo","dijit","text!dijit/templates/Dialog.html","dojo/dnd/move","dojo/dnd/TimedMoveable","dojo/fx","dojo/window","dijit/_Widget","dijit/_Templated","dijit/_CssStateMixin","dijit/form/_FormMixin","dijit/_DialogMixin","dijit/DialogUnderlay","dijit/layout/ContentPane","i18n!dijit/nls/common","dijit/TooltipDialog"],function(a,b){a.declare("dijit._DialogBase",[b._Templated,b.form._FormMixin,b._DialogMixin,b._CssStateMixin],{templateString:a.cache("dijit","templates/Dialog.html"),baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},attributeMap:a.delegate(b._Widget.prototype.attributeMap,{title:[{node:"titleNode",type:"innerHTML"},{node:"titleBar",type:"attribute"}],"aria-describedby":""}),open:!1,duration:b.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,doLayout:!1,draggable:!0,"aria-describedby":"",postMixInProperties:function(){var b=a.i18n.getLocalization("dijit","common");a.mixin(this,b),this.inherited(arguments)},postCreate:function(){a.style(this.domNode,{display:"none",position:"absolute"}),a.body().appendChild(this.domNode),this.inherited(arguments),this.connect(this,"onExecute","hide"),this.connect(this,"onCancel","hide"),this._modalconnects=[]},onLoad:function(){this._position(),this.autofocus&&b._DialogLevelManager.isTop(this)&&(this._getFocusItems(this.domNode),b.focus(this._firstFocusItem)),this.inherited(arguments)},_endDrag:function(b){b&&b.node&&b.node===this.domNode&&(this._relativePosition=a.position(b.node))},_setup:function(){var b=this.domNode;this.titleBar&&this.draggable?(this._moveable=a.isIE==6?new a.dnd.TimedMoveable(b,{handle:this.titleBar}):new a.dnd.Moveable(b,{handle:this.titleBar,timeout:0}),this._dndListener=a.subscribe("/dnd/move/stop",this,"_endDrag")):a.addClass(b,"dijitDialogFixed"),this.underlayAttrs={dialogId:this.id,"class":a.map(this["class"].split(/\s/),function(a){return a+"_underlay"}).join(" ")}},_size:function(){this._checkIfSingleChild(),this._singleChild?(this._singleChildOriginalStyle&&(this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle),delete this._singleChildOriginalStyle):a.style(this.containerNode,{width:"auto",height:"auto"});var b=a._getMarginSize(this.domNode),c=a.window.getBox();if(b.w<c.w&&b.h<c.h)this._singleChild&&this._singleChild.resize&&this._singleChild.resize();else{var d=Math.min(b.w,Math.floor(c.w*.75)),e=Math.min(b.h,Math.floor(c.h*.75));this._singleChild&&this._singleChild.resize?(this._singleChildOriginalStyle=this._singleChild.domNode.style.cssText,this._singleChild.resize({w:d,h:e})):a.style(this.containerNode,{width:d+"px",height:e+"px",overflow:"auto",position:"relative"})}},_position:function(){if(!a.hasClass(a.body(),"dojoMove")){var b=this.domNode,c=a.window.getBox(),d=this._relativePosition,e=d?null:a._getBorderBox(b),f=Math.floor(c.l+(d?d.x:(c.w-e.w)/2)),g=Math.floor(c.t+(d?d.y:(c.h-e.h)/2));a.style(b,{left:f+"px",top:g+"px"})}},_onKey:function(c){if(c.charOrCode){var d=a.keys,e=c.target;c.charOrCode===d.TAB&&this._getFocusItems(this.domNode);var f=this._firstFocusItem==this._lastFocusItem;if(e==this._firstFocusItem&&c.shiftKey&&c.charOrCode===d.TAB)f||b.focus(this._lastFocusItem),a.stopEvent(c);else if(e!=this._lastFocusItem||c.charOrCode!==d.TAB||c.shiftKey){while(e){if(e==this.domNode||a.hasClass(e,"dijitPopup"))if(c.charOrCode==d.ESCAPE)this.onCancel();else return;e=e.parentNode}if(c.charOrCode!==d.TAB)a.stopEvent(c);else if(!a.isOpera)try{this._firstFocusItem.focus()}catch(g){}}else f||b.focus(this._firstFocusItem),a.stopEvent(c)}},show:function(){if(!this.open){this._started||this.startup(),this._alreadyInitialized||(this._setup(),this._alreadyInitialized=!0),this._fadeOutDeferred&&this._fadeOutDeferred.cancel(),this._modalconnects.push(a.connect(window,"onscroll",this,"layout")),this._modalconnects.push(a.connect(window,"onresize",this,function(){var b=a.window.getBox();if(!this._oldViewport||b.h!=this._oldViewport.h||b.w!=this._oldViewport.w)this.layout(),this._oldViewport=b})),this._modalconnects.push(a.connect(this.domNode,"onkeypress",this,"_onKey")),a.style(this.domNode,{opacity:0,display:""}),this._set("open",!0),this._onShow(),this._size(),this._position();var c;this._fadeInDeferred=new a.Deferred(a.hitch(this,function(){c.stop(),delete this._fadeInDeferred})),c=a.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:a.hitch(this,function(){b._DialogLevelManager.show(this,this.underlayAttrs)}),onEnd:a.hitch(this,function(){this.autofocus&&b._DialogLevelManager.isTop(this)&&(this._getFocusItems(this.domNode),b.focus(this._firstFocusItem)),this._fadeInDeferred.callback(!0),delete this._fadeInDeferred})}).play();return this._fadeInDeferred}},hide:function(){if(this._alreadyInitialized){this._fadeInDeferred&&this._fadeInDeferred.cancel();var c;this._fadeOutDeferred=new a.Deferred(a.hitch(this,function(){c.stop(),delete this._fadeOutDeferred})),c=a.fadeOut({node:this.domNode,duration:this.duration,onEnd:a.hitch(this,function(){this.domNode.style.display="none",b._DialogLevelManager.hide(this),this.onHide(),this._fadeOutDeferred.callback(!0),delete this._fadeOutDeferred})}).play(),this._scrollConnected&&(this._scrollConnected=!1),a.forEach(this._modalconnects,a.disconnect),this._modalconnects=[],this._relativePosition&&delete this._relativePosition,this._set("open",!1);return this._fadeOutDeferred}},layout:function(){this.domNode.style.display!="none"&&(b._underlay&&b._underlay.layout(),this._position())},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel(),this._fadeOutDeferred&&this._fadeOutDeferred.cancel(),this._moveable&&this._moveable.destroy(),this._dndListener&&a.unsubscribe(this._dndListener),a.forEach(this._modalconnects,a.disconnect),b._DialogLevelManager.hide(this),this.inherited(arguments)}}),a.declare("dijit.Dialog",[b.layout.ContentPane,b._DialogBase],{}),b._DialogLevelManager={show:function(c,d){var e=b._dialogStack;e[e.length-1].focus=b.getFocus(c);var f=b._underlay;!f||f._destroyed?f=b._underlay=new b.DialogUnderlay(d):f.set(c.underlayAttrs);var g=e[e.length-1].dialog?e[e.length-1].zIndex+2:950;e.length==1&&f.show(),a.style(b._underlay.domNode,"zIndex",g-1),a.style(c.domNode,"zIndex",g),e.push({dialog:c,underlayAttrs:d,zIndex:g})},hide:function(c){var d=b._dialogStack;if(d[d.length-1].dialog==c){d.pop();var e=d[d.length-1];d.length==1?b._underlay._destroyed||b._underlay.hide():(a.style(b._underlay.domNode,"zIndex",e.zIndex-1),b._underlay.set(e.underlayAttrs));if(c.refocus){var f=e.focus;if(!f||e.dialog&&!a.isDescendant(f.node,e.dialog.domNode))e.dialog._getFocusItems(e.dialog.domNode),f=e.dialog._firstFocusItem;try{b.focus(f)}catch(g){}}}else{var h=a.indexOf(a.map(d,function(a){return a.dialog}),c);h!=-1&&d.splice(h,1)}},isTop:function(a){var c=b._dialogStack;return c[c.length-1].dialog==a}},b._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];return b.Dialog})