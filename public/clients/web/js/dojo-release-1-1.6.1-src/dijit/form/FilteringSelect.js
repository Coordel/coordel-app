define("dijit/form/FilteringSelect",["dojo","dijit","dijit/form/ComboBox"],function(a,b){a.declare("dijit.form.FilteringSelect",[b.form.MappedTextBox,b.form.ComboBoxMixin],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return this.item||!this.required&&this.get("displayedValue")==""},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(a,c,d){c&&c.query[this.searchAttr]!=this._lastQuery||!c&&a.length&&this.store.getIdentity(a[0])!=this._lastQuery||(a.length?this.set("item",a[0],d):(this.valueNode.value="",b.form.TextBox.superclass._setValueAttr.call(this,"",d||d===undefined&&!this._focused),this._set("item",null),this.validate(this._focused)))},_openResultList:function(a,c){c.query[this.searchAttr]==this._lastQuery&&(b.form.ComboBoxMixin.prototype._openResultList.apply(this,arguments),this.item===undefined&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(a,b){this._onChangeActive||(b=null),this._lastQuery=a;if(a===null||a==="")this._setDisplayedValueAttr("",b);else{var c=this;this.store.fetchItemByIdentity({identity:a,onItem:function(a){c._callbackSetLabel(a?[a]:[],undefined,b)}})}},_setItemAttr:function(a,b,c){this.inherited(arguments),this.valueNode.value=this.value,this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(a){return a.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(b,c){b==null&&(b="");if(!this._created){if(!("displayedValue"in this.params))return;c=!1}if(this.store){this.closeDropDown();var d=a.clone(this.query);this._lastQuery=d[this.searchAttr]=this._getDisplayQueryString(b),this.textbox.value=b,this._lastDisplayedValue=b,this._set("displayedValue",b);var e=this,f={query:d,queryOptions:{ignoreCase:this.ignoreCase,deep:!0},onComplete:function(b,d){e._fetchHandle=null,a.hitch(e,"_callbackSetLabel")(b,d,c)},onError:function(b){e._fetchHandle=null,console.error("dijit.form.FilteringSelect: "+b),a.hitch(e,"_callbackSetLabel")([],undefined,!1)}};a.mixin(f,this.fetchProperties),this._fetchHandle=this.store.fetch(f)}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}});return b.form.FilteringSelect})