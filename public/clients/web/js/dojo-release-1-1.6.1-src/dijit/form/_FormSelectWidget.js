define("dijit/form/_FormSelectWidget",["dojo","dijit","dijit/form/_FormWidget","dojo/data/util/sorter"],function(a,b){a.declare("dijit.form._FormSelectWidget",b.form._FormValueWidget,{multiple:!1,options:null,store:null,query:null,queryOptions:null,onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,getOptions:function(b){var c=b,d=this.options||[],e=d.length;if(c===undefined)return d;if(a.isArray(c))return a.map(c,"return this.getOptions(item);",this);a.isObject(b)&&(a.some(this.options,function(a,b){if(a===c||a.value&&a.value===c.value){c=b;return!0}return!1})||(c=-1));if(typeof c=="string")for(var f=0;f<e;f++)if(d[f].value===c){c=f;break}if(typeof c=="number"&&c>=0&&c<e)return this.options[c];return null},addOption:function(b){a.isArray(b)||(b=[b]),a.forEach(b,function(b){b&&a.isObject(b)&&this.options.push(b)},this),this._loadChildren()},removeOption:function(b){a.isArray(b)||(b=[b]);var c=this.getOptions(b);a.forEach(c,function(b){b&&(this.options=a.filter(this.options,function(a,c){return a.value!==b.value||a.label!==b.label}),this._removeOptionItem(b))},this),this._loadChildren()},updateOption:function(b){a.isArray(b)||(b=[b]),a.forEach(b,function(a){var b=this.getOptions(a),c;if(b)for(c in a)b[c]=a[c]},this),this._loadChildren()},setStore:function(b,c,d){var e=this.store;d=d||{},e!==b&&(a.forEach(this._notifyConnections||[],a.disconnect),delete this._notifyConnections,b&&b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[a.connect(b,"onNew",this,"_onNewItem"),a.connect(b,"onDelete",this,"_onDeleteItem"),a.connect(b,"onSet",this,"_onSetItem")]),this._set("store",b)),this._onChangeActive=!1,this.options&&this.options.length&&this.removeOption(this.options),b?(this._loadingStore=!0,b.fetch(a.delegate(d,{onComplete:function(e,f){this.sortByLabel&&!d.sort&&e.length&&e.sort(a.data.util.sorter.createSortFunction([{attribute:b.getLabelAttributes(e[0])[0]}],b)),d.onFetch&&(e=d.onFetch.call(this,e,f)),a.forEach(e,function(a){this._addOptionForItem(a)},this),this._loadingStore=!1,this.set("value","_pendingValue"in this?this._pendingValue:c),delete this._pendingValue,this.loadChildrenOnOpen?this._pseudoLoadChildren(e):this._loadChildren(),this._fetchedWith=f,this._lastValueReported=this.multiple?[]:null,this._onChangeActive=!0,this.onSetStore(),this._handleOnChange(this.value)},scope:this}))):delete this._fetchedWith;return e},_setValueAttr:function(b,c){if(this._loadingStore)this._pendingValue=b;else{var d=this.getOptions()||[];a.isArray(b)||(b=[b]),a.forEach(b,function(c,e){a.isObject(c)||(c=c+""),typeof c==="string"&&(b[e]=a.filter(d,function(a){return a.value===c})[0]||{value:"",label:""})},this),b=a.filter(b,function(a){return a&&a.value}),!this.multiple&&(!b[0]||!b[0].value)&&d.length&&(b[0]=d[0]),a.forEach(d,function(c){c.selected=a.some(b,function(a){return a.value===c.value})});var e=a.map(b,function(a){return a.value}),f=a.map(b,function(a){return a.label});this._set("value",this.multiple?e:e[0]),this._setDisplay(this.multiple?f:f[0]),this._updateSelection(),this._handleOnChange(this.value,c)}},_getDisplayedValueAttr:function(){var b=this.get("value");a.isArray(b)||(b=[b]);var c=a.map(this.getOptions(b),function(a){if(a&&"label"in a)return a.label;if(a)return a.value;return null},this);return this.multiple?c:c[0]},_loadChildren:function(){this._loadingStore||(a.forEach(this._getChildren(),function(a){a.destroyRecursive()}),a.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this._set("value",this._getValueFromOpts());var c=this.value;a.isArray(c)||(c=[c]),c&&c[0]&&a.forEach(this._getChildren(),function(d){var e=a.some(c,function(a){return d.option&&a===d.option.value});a.toggleClass(d.domNode,this.baseClass+"SelectedOption",e),b.setWaiState(d.domNode,"selected",e)},this)},_getValueFromOpts:function(){var b=this.getOptions()||[];if(!this.multiple&&b.length){var c=a.filter(b,function(a){return a.selected})[0];if(c&&c.value)return c.value;b[0].selected=!0;return b[0].value}if(this.multiple)return a.map(a.filter(b,function(a){return a.selected}),function(a){return a.value})||[];return""},_onNewItem:function(a,b){(!b||!b.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){var b=this.store;this.removeOption(b.getIdentity(a))},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=b.getLabel(a),d=c?b.getIdentity(a):null;return{value:d,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;if(b.isItemLoaded(a)){var c=this._getOptionObjForItem(a);this.addOption(c)}else b.loadItem({item:a,onComplete:function(b){this._addOptionForItem(a)},scope:this})},constructor:function(a){this._oValue=(a||{}).value||null},buildRendering:function(){this.inherited(arguments),a.setSelectable(this.focusNode,!1)},_fillContent:function(){var b=this.options;b||(b=this.options=this.srcNodeRef?a.query(">",this.srcNodeRef).map(function(b){if(b.getAttribute("type")==="separator")return{value:"",label:"",selected:!1,disabled:!1};return{value:b.getAttribute("data-"+a._scopeName+"-value")||b.getAttribute("value"),label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]),this.value?this.multiple&&typeof this.value=="string"&&this_set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments),this.connect(this,"onChange","_updateSelection"),this.connect(this,"startup","_loadChildren"),this._setValueAttr(this.value,null)},startup:function(){this.inherited(arguments);var b=this.store,c={};a.forEach(["query","queryOptions","onFetch"],function(a){this[a]&&(c[a]=this[a]),delete this[a]},this),b&&b.getFeatures()["dojo.data.api.Identity"]&&(this.store=null,this.setStore(b,this._oValue,c))},destroy:function(){a.forEach(this._notifyConnections||[],a.disconnect),this.inherited(arguments)},_addOptionItem:function(a){},_removeOptionItem:function(a){},_setDisplay:function(a){},_getChildren:function(){return[]},_getSelectedOptionsAttr:function(){return this.getOptions(this.get("value"))},_pseudoLoadChildren:function(a){},onSetStore:function(){}});return b.form._FormSelectWidget})