define("dijit/_editor/RichText",["dojo","dijit","dijit/_Widget","dijit/_CssStateMixin","dijit/_editor/selection","dijit/_editor/range","dijit/_editor/html"],function(a,b){if(!a.config.useXDomain||a.config.allowXdRichTextSave)if(a._postLoad)(function(){var c=a.doc.createElement("textarea");c.id=b._scopeName+"._editor.RichText.value",a.style(c,{display:"none",position:"absolute",top:"-100px",height:"3px",width:"3px"}),a.body().appendChild(c)})();else try{a.doc.write('<textarea id="'+b._scopeName+'._editor.RichText.value" style="display:none;position:absolute;top:-100px;left:-100px;height:3px;width:3px;overflow:hidden;"></textarea>')}catch(c){}a.declare("dijit._editor.RichText",[b._Widget,b._CssStateMixin],{constructor:function(b){this.contentPreFilters=[],this.contentPostFilters=[],this.contentDomPreFilters=[],this.contentDomPostFilters=[],this.editingAreaStyleSheets=[],this.events=[].concat(this.events),this._keyHandlers={},b&&a.isString(b.value)&&(this.value=b.value),this.onLoadDeferred=new a.Deferred},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"==this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs."),this.contentPreFilters=[a.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters),a.isMoz&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters)),a.isWebKit&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters)),a.isIE&&(this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters)),this.inherited(arguments),a.publish(b._scopeName+"._editor.RichText::init",[this]),this.open(),this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var b=a.hitch(this,function(a,b){return function(){return!this.execCommand(a,b)}}),c={b:b("bold"),i:b("italic"),u:b("underline"),a:b("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:b("formatblock","h1"),2:b("formatblock","h2"),3:b("formatblock","h3"),4:b("formatblock","h4"),"\\":b("insertunorderedlist")};a.isIE||(c.Z=b("redo"));for(var d in c)this.addKeyHandler(d,!0,!1,c[d])},events:["onKeyPress","onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(b._editor._editorCommandsLocalized)this._local2NativeFormatNames=b._editor._local2NativeFormatNames,this._native2LocalFormatNames=b._editor._native2LocalFormatNames;else{b._editor._editorCommandsLocalized=!0,b._editor._local2NativeFormatNames={},b._editor._native2LocalFormatNames={},this._local2NativeFormatNames=b._editor._local2NativeFormatNames,this._native2LocalFormatNames=b._editor._native2LocalFormatNames;var c=["div","p","pre","h1","h2","h3","h4","h5","h6","ol","ul","address"],d="",e,f=0;while(e=c[f++])e.charAt(1)!=="l"?d+="<"+e+"><span>content</span></"+e+"><br/>":d+="<"+e+"><li>content</li></"+e+"><br/>";var g={position:"absolute",top:"0px",zIndex:10,opacity:.01},h=a.create("div",{style:g,innerHTML:d});a.body().appendChild(h);var i=a.hitch(this,function(){var a=h.firstChild;while(a)try{b._editor.selection.selectElement(a.firstChild);var c=a.tagName.toLowerCase();this._local2NativeFormatNames[c]=document.queryCommandValue("formatblock"),this._native2LocalFormatNames[this._local2NativeFormatNames[c]]=c,a=a.nextSibling.nextSibling}catch(d){}h.parentNode.removeChild(h),h.innerHTML=""});setTimeout(i,0)}},open:function(c){if(!this.onLoadDeferred||this.onLoadDeferred.fired>=0)this.onLoadDeferred=new a.Deferred;this.isClosed||this.close(),a.publish(b._scopeName+"._editor.RichText::open",[this]),arguments.length==1&&c.nodeName&&(this.domNode=c);var d=this.domNode,e;if(a.isString(this.value))e=this.value,delete this.value,d.innerHTML="";else if(d.nodeName&&d.nodeName.toLowerCase()=="textarea"){var f=this.textarea=d;this.name=f.name,e=f.value,d=this.domNode=a.doc.createElement("div"),d.setAttribute("widgetId",this.id),f.removeAttribute("widgetId"),d.cssText=f.cssText,d.className+=" "+f.className,a.place(d,f,"before");var g=a.hitch(this,function(){a.style(f,{display:"block",position:"absolute",top:"-1000px"});if(a.isIE){var b=f.style;this.__overflow=b.overflow,b.overflow="hidden"}});a.isIE?setTimeout(g,10):g();if(f.form){var h=f.value;this.reset=function(){var a=this.getValue();a!=h&&this.replaceValue(h)},a.connect(f.form,"onsubmit",this,function(){a.attr(f,"disabled",this.disabled),f.value=this.getValue()})}}else e=b._editor.getChildrenHtml(d),d.innerHTML="";var i=a.contentBox(d);this._oldHeight=i.h,this._oldWidth=i.w,this.value=e,d.nodeName&&d.nodeName=="LI"&&(d.innerHTML=" <br>"),this.header=d.ownerDocument.createElement("div"),d.appendChild(this.header),this.editingArea=d.ownerDocument.createElement("div"),d.appendChild(this.editingArea),this.footer=d.ownerDocument.createElement("div"),d.appendChild(this.footer),this.name||(this.name=this.id+"_AUTOGEN");if(this.name!==""&&(!a.config.useXDomain||a.config.allowXdRichTextSave)){var j=a.byId(b._scopeName+"._editor.RichText.value");if(j&&j.value!==""){var k=j.value.split(this._SEPARATOR),l=0,m;while(m=k[l++]){var n=m.split(this._NAME_CONTENT_SEP);if(n[0]==this.name){e=n[1],k=k.splice(l,1),j.value=k.join(this._SEPARATOR);break}}}b._editor._globalSaveHandler||(b._editor._globalSaveHandler={},a.addOnUnload(function(){var c;for(c in b._editor._globalSaveHandler){var d=b._editor._globalSaveHandler[c];a.isFunction(d)&&d()}})),b._editor._globalSaveHandler[this.id]=a.hitch(this,"_saveContent")}this.isClosed=!1;var o=this.editorObject=this.iframe=a.doc.createElement("iframe");o.id=this.id+"_iframe",this._iframeSrc=this._getIframeDocTxt(),o.style.border="none",o.style.width="100%",this._layoutMode?o.style.height="100%":a.isIE<7?o.style.height=this.height?this.height:this.minHeight:(this.height&&(o.style.height=this.height),this.minHeight&&(o.style.minHeight=this.minHeight)),o.frameBorder=0,o._loadFunc=a.hitch(this,function(b){this.window=b,this.document=this.window.document,a.isIE&&this._localizeEditorCommands(),this.onLoad(e)});var p="javascript:parent."+b._scopeName+'.byId("'+this.id+'")._iframeSrc';o.setAttribute("src",p),this.editingArea.appendChild(o);if(a.isSafari<=4){var q=o.getAttribute("src");(!q||q.indexOf("javascript")==-1)&&setTimeout(function(){o.setAttribute("src",p)},0)}d.nodeName=="LI"&&(d.lastChild.style.marginTop="-1.2em"),a.addClass(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var b=a.getComputedStyle(this.domNode),c="",d=!0;a.isIE||a.isWebKit||!this.height&&!a.isMoz?(c="<div id='dijitEditorBody'></div>",d=!1):a.isMoz&&(this._cursorToStart=!0,c="&nbsp;");var e=[b.fontWeight,b.fontSize,b.fontFamily].join(" "),f=b.lineHeight;f.indexOf("px")<0?f.indexOf("em")<0?f="normal":f=parseFloat(f):f=parseFloat(f)/parseFloat(b.fontSize);var g="",h=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(b){b=b.replace(/^;/ig,"")+";";var c=b.split(":")[0];if(c){c=a.trim(c),c=c.toLowerCase();var d,e="";for(d=0;d<c.length;d++){var f=c.charAt(d);switch(f){case"-":d++,f=c.charAt(d).toUpperCase();default:e+=f}}a.style(h.domNode,e,"")}g+=b+";"});var i=a.query('label[for="'+this.id+'"]');return[this.isLeftToRight()?"<html>\n<head>\n":"<html dir='rtl'>\n<head>\n",a.isMoz&&i.length?"<title>"+i[0].innerHTML+"</title>\n":"","<meta http-equiv='Content-Type' content='text/html'>\n","<style>\n","\tbody,html {\n","\t\tbackground:transparent;\n","\t\tpadding: 1px 0 0 0;\n","\t\tmargin: -1px 0 0 0;\n",a.isWebKit?"\t\twidth: 100%;\n":"",a.isWebKit?"\t\theight: 100%;\n":"","\t}\n","\tbody{\n","\t\ttop:0px;\n","\t\tleft:0px;\n","\t\tright:0px;\n","\t\tfont:",e,";\n",this.height||a.isOpera?"":"\t\tposition: fixed;\n","\t\tmin-height:",this.minHeight,";\n","\t\tline-height:",f,";\n","\t}\n","\tp{ margin: 1em 0; }\n",!d&&!this.height?"\tbody,html {overflow-y: hidden;}\n":"","\t#dijitEditorBody{overflow-x: auto; overflow-y:"+(this.height?"auto;":"hidden;")+" outline: 0px;}\n","\tli > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; }\n",a.isIE?"":"\tli{ min-height:1.2em; }\n","</style>\n",this._applyEditingAreaStyleSheets(),"\n","</head>\n<body ",d?"id='dijitEditorBody' ":"","onload='frameElement._loadFunc(window,document)' style='"+g+"'>",c,"</body>\n</html>"].join("")},_applyEditingAreaStyleSheets:function(){var b=[];this.styleSheets&&(b=this.styleSheets.split(";"),this.styleSheets=""),b=b.concat(this.editingAreaStyleSheets),this.editingAreaStyleSheets=[];var c="",d=0,e;while(e=b[d++]){var f=(new a._Url(a.global.location,e)).toString();this.editingAreaStyleSheets.push(f),c+='<link rel="stylesheet" type="text/css" href="'+f+'"/>'}return c},addStyleSheet:function(b){var c=b.toString();if(c.charAt(0)=="."||c.charAt(0)!="/"&&!b.host)c=(new a._Url(a.global.location,c)).toString();a.indexOf(this.editingAreaStyleSheets,c)<=-1&&(this.editingAreaStyleSheets.push(c),this.onLoadDeferred.addCallback(a.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(c);else{var a=this.document.getElementsByTagName("head")[0],b=this.document.createElement("link");b.rel="stylesheet",b.type="text/css",b.href=c,a.appendChild(b)}})))},removeStyleSheet:function(b){var c=b.toString();if(c.charAt(0)=="."||c.charAt(0)!="/"&&!b.host)c=(new a._Url(a.global.location,c)).toString();var d=a.indexOf(this.editingAreaStyleSheets,c);d!=-1&&(delete this.editingAreaStyleSheets[d],a.withGlobal(this.window,"query",a,['link:[href="'+c+'"]']).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(b){b=!!b,this._set("disabled",b);if(this.isLoaded){if(a.isIE||a.isWebKit||a.isOpera){var c=a.isIE&&(this.isLoaded||!this.focusOnLoad);c&&(this.editNode.unselectable="on"),this.editNode.contentEditable=!b;if(c){var d=this;setTimeout(function(){d.editNode.unselectable="off"},0)}}else{try{this.document.designMode=b?"off":"on"}catch(e){return}if(!b&&this._mozSettingProps){var f=this._mozSettingProps;for(var g in f)if(f.hasOwnProperty(g))try{this.document.execCommand(g,!1,f[g])}catch(h){}}}this._disabledOK=!0}},onLoad:function(c){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=b.registerIframe(this.iframe));if(a.isIE||a.isWebKit||!this.height&&!a.isMoz){this.editNode=this.document.body.firstChild;var d=this;a.isIE&&(this.tabStop=a.create("div",{tabIndex:-1},this.editingArea),this.iframe.onfocus=function(){d.editNode.setActive()})}else this.editNode=this.document.body;this.focusNode=this.editNode;var e=this.events.concat(this.captureEvents),f=this.iframe?this.document:this.editNode;a.forEach(e,function(a){this.connect(f,a.toLowerCase(),a)},this),this.connect(f,"onmouseup","onClick"),a.isIE?(this.connect(this.document,"onmousedown","_onIEMouseDown"),this.editNode.style.zoom=1):this.connect(this.document,"onmousedown",function(){delete this._cursorToStart}),a.isWebKit&&(this._webkitListener=this.connect(this.document,"onmouseup","onDisplayChanged"),this.connect(this.document,"onmousedown",function(b){var c=b.target;c&&(c===this.document.body||c===this.document)&&setTimeout(a.hitch(this,"placeCursorAtEnd"),0)}));if(a.isIE)try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(g){}this.isLoaded=!0,this.set("disabled",this.disabled);var h=a.hitch(this,function(){this.setValue(c),this.onLoadDeferred&&this.onLoadDeferred.callback(!0),this.onDisplayChanged(),this.focusOnLoad&&a.addOnLoad(a.hitch(this,function(){setTimeout(a.hitch(this,"focus"),this.updateInterval)})),this.value=this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.addCallback(h):h()},onKeyDown:function(b){b.keyCode===a.keys.TAB&&this.isTabIndent&&(a.stopEvent(b),this.queryCommandEnabled(b.shiftKey?"outdent":"indent")&&this.execCommand(b.shiftKey?"outdent":"indent"));if(a.isIE)if(b.keyCode!=a.keys.TAB||this.isTabIndent){if(b.keyCode===a.keys.BACKSPACE&&this.document.selection.type==="Control")a.stopEvent(b),this.execCommand("delete");else if(65<=b.keyCode&&b.keyCode<=90||b.keyCode>=37&&b.keyCode<=40)b.charCode=b.keyCode,this.onKeyPress(b)}else!b.shiftKey||b.ctrlKey||b.altKey?!b.shiftKey&&!b.ctrlKey&&!b.altKey&&this.tabStop.focus():this.iframe.focus();return!0},onKeyUp:function(a){return},setDisabled:function(b){a.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2),this.set("disabled",b)},_setValueAttr:function(a){this.setValue(a)},_setDisableSpellCheckAttr:function(b){this.document?a.attr(this.document.body,"spellcheck",!b):this.onLoadDeferred.addCallback(a.hitch(this,function(){a.attr(this.document.body,"spellcheck",!b)})),this._set("disableSpellCheck",b)},onKeyPress:function(b){var c=b.keyChar&&b.keyChar.toLowerCase()||b.keyCode,d=this._keyHandlers[c],e=arguments;d&&!b.altKey&&a.some(d,function(a){if(!(a.shift^b.shiftKey)&&!(a.ctrl^(b.ctrlKey||b.metaKey))){a.handler.apply(this,e)||b.preventDefault();return!0}},this),this._onKeyHitch||(this._onKeyHitch=a.hitch(this,"onKeyPressed")),setTimeout(this._onKeyHitch,1);return!0},addKeyHandler:function(b,c,d,e){a.isArray(this._keyHandlers[b])||(this._keyHandlers[b]=[]),this._keyHandlers[b].push({shift:d||!1,ctrl:c||!1,handler:e})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(a){this.onDisplayChanged(a)},_onIEMouseDown:function(a){!this._focused&&!this.disabled&&this.focus()},_onBlur:function(a){this.inherited(arguments);var b=this.getValue(!0);b!=this.value&&this.onChange(b),this._set("value",b)},_onFocus:function(a){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!a.isIE&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():a.doc.body.focus&&a.doc.body.focus()},focus:function(){if(this.isLoaded){if(this._cursorToStart){delete this._cursorToStart;if(this.editNode.childNodes){this.placeCursorAtStart();return}}a.isIE?this.editNode&&this.editNode.focus&&this.iframe.fireEvent("onfocus",document.createEventObject()):b.focus(this.iframe)}else this.focusOnLoad=!0},updateInterval:200,_updateTimer:null,onDisplayChanged:function(b){this._updateTimer&&clearTimeout(this._updateTimer),this._updateHandler||(this._updateHandler=a.hitch(this,"onNormalizedDisplayChanged")),this._updateTimer=setTimeout(this._updateHandler,this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(a){},_normalizeCommand:function(b,c){var d=b.toLowerCase();d=="formatblock"?a.isSafari&&c===undefined&&(d="heading"):d=="hilitecolor"&&!a.isMoz&&(d="backcolor");return d},_qcaCache:{},queryCommandAvailable:function(a){var b=this._qcaCache[a];if(b!==undefined)return b;return this._qcaCache[a]=this._queryCommandAvailable(a)},_queryCommandAvailable:function(b){function g(a){return{ie:Boolean(a&c),mozilla:Boolean(a&d),webkit:Boolean(a&e),opera:Boolean(a&f)}}var c=1,d=2,e=4,f=8,h=null;switch(b.toLowerCase()){case"bold":case"italic":case"underline":case"subscript":case"superscript":case"fontname":case"fontsize":case"forecolor":case"hilitecolor":case"justifycenter":case"justifyfull":case"justifyleft":case"justifyright":case"delete":case"selectall":case"toggledir":h=g(d|c|e|f);break;case"createlink":case"unlink":case"removeformat":case"inserthorizontalrule":case"insertimage":case"insertorderedlist":case"insertunorderedlist":case"indent":case"outdent":case"formatblock":case"inserthtml":case"undo":case"redo":case"strikethrough":case"tabindent":h=g(d|c|f|e);break;case"blockdirltr":case"blockdirrtl":case"dirltr":case"dirrtl":case"inlinedirltr":case"inlinedirrtl":h=g(c);break;case"cut":case"copy":case"paste":h=g(c|d|e);break;case"inserttable":h=g(d|c);break;case"insertcell":case"insertcol":case"insertrow":case"deletecells":case"deletecols":case"deleterows":case"mergecells":case"splitcell":h=g(c|d);break;default:return!1}return a.isIE&&h.ie||a.isMoz&&h.mozilla||a.isWebKit&&h.webkit||a.isOpera&&h.opera},execCommand:function(b,c){var d;this.focus(),b=this._normalizeCommand(b,c);if(c!==undefined){if(b=="heading")throw new Error("unimplemented");b=="formatblock"&&a.isIE&&(c="<"+c+">")}var e="_"+b+"Impl";if(this[e])d=this[e](c);else{c=arguments.length>1?c:null;if(c||b!="createlink")d=this.document.execCommand(b,!1,c)}this.onDisplayChanged();return d},queryCommandEnabled:function(b){if(this.disabled||!this._disabledOK)return!1;b=this._normalizeCommand(b);if(a.isMoz||a.isWebKit){if(b=="unlink")return this._sCall("hasAncestorElement",["a"]);if(b=="inserttable")return!0}if(a.isWebKit){if(b=="cut"||b=="copy"){var c=this.window.getSelection();c&&(c=c.toString());return!!c}if(b=="paste")return!0}var d=a.isIE?this.document.selection.createRange():this.document;try{return d.queryCommandEnabled(b)}catch(e){return!1}},queryCommandState:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);try{return this.document.queryCommandState(a)}catch(b){return!1}},queryCommandValue:function(b){if(this.disabled||!this._disabledOK)return!1;var c;b=this._normalizeCommand(b);if(a.isIE&&b=="formatblock")c=this._native2LocalFormatNames[this.document.queryCommandValue(b)];else if(a.isMoz&&b==="hilitecolor"){var d;try{d=this.document.queryCommandValue("styleWithCSS")}catch(e){d=!1}this.document.execCommand("styleWithCSS",!1,!0),c=this.document.queryCommandValue(b),this.document.execCommand("styleWithCSS",!1,d)}else c=this.document.queryCommandValue(b);return c},_sCall:function(c,d){return a.withGlobal(this.window,c,b._editor.selection,d)},placeCursorAtStart:function(){this.focus();var b=!1;if(a.isMoz){var c=this.editNode.firstChild;while(c){if(c.nodeType==3){if(c.nodeValue.replace(/^\s+|\s+$/g,"").length>0){b=!0,this._sCall("selectElement",[c]);break}}else if(c.nodeType==1){b=!0;var d=c.tagName?c.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(d)?this._sCall("selectElement",[c]):this._sCall("selectElementChildren",[c]);break}c=c.nextSibling}}else b=!0,this._sCall("selectElementChildren",[this.editNode]);b&&this._sCall("collapse",[!0])},placeCursorAtEnd:function(){this.focus();var b=!1;if(a.isMoz){var c=this.editNode.lastChild;while(c){if(c.nodeType==3){if(c.nodeValue.replace(/^\s+|\s+$/g,"").length>0){b=!0,this._sCall("selectElement",[c]);break}}else if(c.nodeType==1){b=!0,c.lastChild?this._sCall("selectElement",[c.lastChild]):this._sCall("selectElement",[c]);break}c=c.previousSibling}}else b=!0,this._sCall("selectElementChildren",[this.editNode]);b&&this._sCall("collapse",[!1])},getValue:function(a){if(this.textarea)if(this.isClosed||!this.isLoaded)return this.textarea.value;return this._postFilterContent(null,a)},_getValueAttr:function(){return this.getValue(!0)},setValue:function(b){if(this.isLoaded){this._cursorToStart=!0;if(!this.textarea||!this.isClosed&&this.isLoaded){b=this._preFilterContent(b);var c=this.isClosed?this.domNode:this.editNode;b&&a.isMoz&&b.toLowerCase()=="<p></p>"&&(b="<p>&nbsp;</p>"),!b&&a.isWebKit&&(b="&nbsp;"),c.innerHTML=b,this._preDomFilterContent(c)}else this.textarea.value=b;this.onDisplayChanged(),this._set("value",this.getValue(!0))}else this.onLoadDeferred.addCallback(a.hitch(this,function(){this.setValue(b)}))},replaceValue:function(b){this.isClosed?this.setValue(b):this.window&&this.window.getSelection&&!a.isMoz?this.setValue(b):this.window&&this.window.getSelection?(b=this._preFilterContent(b),this.execCommand("selectall"),b||(this._cursorToStart=!0,b="&nbsp;"),this.execCommand("inserthtml",b),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(b),this._set("value",this.getValue(!0))},_preFilterContent:function(b){var c=b;a.forEach(this.contentPreFilters,function(a){a&&(c=a(c))});return c},_preDomFilterContent:function(b){b=b||this.editNode,a.forEach(this.contentDomPreFilters,function(c){c&&a.isFunction(c)&&c(b)},this)},_postFilterContent:function(c,d){var e;a.isString(c)?e=c:(c=c||this.editNode,this.contentDomPostFilters.length&&(d&&(c=a.clone(c)),a.forEach(this.contentDomPostFilters,function(a){c=a(c)})),e=b._editor.getChildrenHtml(c)),a.trim(e.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(e=""),a.forEach(this.contentPostFilters,function(a){e=a(e)});return e},_saveContent:function(c){var d=a.byId(b._scopeName+"._editor.RichText.value");d.value&&(d.value+=this._SEPARATOR),d.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0)},escapeXml:function(a,b){a=a.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;"),b||(a=a.replace(/'/gm,"&#39;"));return a},getNodeHtml:function(c){a.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit._editor.getNodeHtml instead",2);return b._editor.getNodeHtml(c)},getNodeChildrenHtml:function(c){a.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit._editor.getChildrenHtml instead",2);return b._editor.getChildrenHtml(c)},close:function(c){if(!this.isClosed){arguments.length||(c=!0),c&&this._set("value",this.getValue(!0)),this.interval&&clearInterval(this.interval),this._webkitListener&&(this.disconnect(this._webkitListener),delete this._webkitListener),a.isIE&&(this.iframe.onfocus=null),this.iframe._loadFunc=null,this._iframeRegHandle&&(b.unregisterIframe(this._iframeRegHandle),delete this._iframeRegHandle);if(this.textarea){var d=this.textarea.style;d.position="",d.left=d.top="",a.isIE&&(d.overflow=this.__overflow,this.__overflow=null),this.textarea.value=this.value,a.destroy(this.domNode),this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe,a.removeClass(this.domNode,this.baseClass),this.isClosed=!0,this.isLoaded=!1,delete this.editNode,delete this.focusNode,this.window&&this.window._frameElement&&(this.window._frameElement=null),this.window=null,this.document=null,this.editingArea=null,this.editorObject=null}},destroy:function(){this.isClosed||this.close(!1),this.inherited(arguments),b._editor._globalSaveHandler&&delete b._editor._globalSaveHandler[this.id]},_removeMozBogus:function(a){return a.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(a){a=a.replace(/\sclass="webkit-block-placeholder"/gi,""),a=a.replace(/\sclass="apple-style-span"/gi,""),a=a.replace(/<meta charset=\"utf-8\" \/>/gi,"");return a},_normalizeFontStyle:function(a){return a.replace(/<(\/)?strong([ \>])/gi,"<$1b$2").replace(/<(\/)?em([ \>])/gi,"<$1i$2")},_preFixUrlAttributes:function(a){return a.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2")},_inserthorizontalruleImpl:function(b){if(a.isIE)return this._inserthtmlImpl("<hr>");return this.document.execCommand("inserthorizontalrule",!1,b)},_unlinkImpl:function(b){if(this.queryCommandEnabled("unlink")&&(a.isMoz||a.isWebKit)){var c=this._sCall("getAncestorElement",["a"]);this._sCall("selectElement",[c]);return this.document.execCommand("unlink",!1,null)}return this.document.execCommand("unlink",!1,b)},_hilitecolorImpl:function(b){var c;a.isMoz?(this.document.execCommand("styleWithCSS",!1,!0),c=this.document.execCommand("hilitecolor",!1,b),this.document.execCommand("styleWithCSS",!1,!1)):c=this.document.execCommand("hilitecolor",!1,b);return c},_backcolorImpl:function(b){a.isIE&&(b=b?b:null);return this.document.execCommand("backcolor",!1,b)},_forecolorImpl:function(b){a.isIE&&(b=b?b:null);return this.document.execCommand("forecolor",!1,b)},_inserthtmlImpl:function(b){b=this._preFilterContent(b);var c=!0;if(a.isIE){var d=this.document.selection.createRange();if(this.document.selection.type.toUpperCase()=="CONTROL"){var e=d.item(0);while(d.length)d.remove(d.item(0));e.outerHTML=b}else d.pasteHTML(b);d.select()}else a.isMoz&&!b.length?this._sCall("remove"):c=this.document.execCommand("inserthtml",!1,b);return c},_boldImpl:function(b){a.isIE&&this._adaptIESelection();return this.document.execCommand("bold",!1,b)},_italicImpl:function(b){a.isIE&&this._adaptIESelection();return this.document.execCommand("italic",!1,b)},_underlineImpl:function(b){a.isIE&&this._adaptIESelection();return this.document.execCommand("underline",!1,b)},_strikethroughImpl:function(b){a.isIE&&this._adaptIESelection();return this.document.execCommand("strikethrough",!1,b)},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(b){var c=0;if(b&&b.childNodes){var d;for(d=0;d<b.childNodes.length;d++){var e=a.position(b.childNodes[d]);c+=e.h}}return c},_isNodeEmpty:function(a,b){if(a.nodeType==1){if(a.childNodes.length>0)return this._isNodeEmpty(a.childNodes[0],b);return!0}if(a.nodeType==3)return a.nodeValue.substring(b)=="";return!1},_removeStartingRangeFromRange:function(a,b){if(a.nextSibling)b.setStart(a.nextSibling,0);else{var c=a.parentNode;while(c&&c.nextSibling==null)c=c.parentNode;c&&b.setStart(c.nextSibling,0)}return b},_adaptIESelection:function(){var a=b.range.getSelection(this.window);if(a&&a.rangeCount&&!a.isCollapsed){var c=a.getRangeAt(0),d=c.startContainer,e=c.startOffset;while(d.nodeType==3&&e>=d.length&&d.nextSibling)e=e-d.length,d=d.nextSibling;var f=null;while(this._isNodeEmpty(d,e)&&d!=f)f=d,c=this._removeStartingRangeFromRange(d,c),d=c.startContainer,e=0;a.removeAllRanges(),a.addRange(c)}}});return b._editor.RichText})