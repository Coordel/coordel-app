define("dijit/_editor/plugins/FontChoice",["dojo","dijit","dijit/_editor/_Plugin","dijit/_editor/range","dijit/_editor/selection","dijit/form/FilteringSelect","dojo/data/ItemFileReadStore","dojo/i18n","i18n!dijit/_editor/nls/FontChoice"],function(a,b){a.declare("dijit._editor.plugins._FontDropDown",[b._Widget,b._Templated],{label:"",widgetsInTemplate:!0,plainText:!1,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'><label class='dijitLeft dijitInline' for='${selectId}'>${label}</label><input dojoType='dijit.form.FilteringSelect' required='false' labelType='html' labelAttr='label' searchAttr='name' tabIndex='-1' id='${selectId}' dojoAttachPoint='select' value=''/></span>",postMixInProperties:function(){this.inherited(arguments),this.strings=a.i18n.getLocalization("dijit._editor","FontChoice"),this.label=this.strings[this.command],this.id=b.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.selectId=this.id+"_select",this.inherited(arguments)},postCreate:function(){var b=a.map(this.values,function(a){var b=this.strings[a]||a;return{label:this.getLabel(a,b),name:b,value:a}},this);this.select.store=new a.data.ItemFileReadStore({data:{identifier:"value",items:b}}),this.select.set("value","",!1),this.disabled=this.select.get("disabled")},_setValueAttr:function(b,c){c=c!==!1?!0:!1,this.select.set("value",a.indexOf(this.values,b)<0?"":b,c),c||(this.select._lastValueReported=null)},_getValueAttr:function(){return this.select.get("value")},focus:function(){this.select.focus()},_setDisabledAttr:function(a){this.disabled=a,this.select.set("disabled",a)}}),a.declare("dijit._editor.plugins._FontNameDropDown",b._editor.plugins._FontDropDown,{generic:!1,command:"fontName",postMixInProperties:function(){this.values||(this.values=this.generic?["serif","sans-serif","monospace","cursive","fantasy"]:["Arial","Times New Roman","Comic Sans MS","Courier New"]),this.inherited(arguments)},getLabel:function(a,b){return this.plainText?b:"<div style='font-family: "+a+"'>"+b+"</div>"},_setValueAttr:function(a,b){b=b!==!1?!0:!1;if(this.generic){var c={Arial:"sans-serif",Helvetica:"sans-serif",Myriad:"sans-serif",Times:"serif","Times New Roman":"serif","Comic Sans MS":"cursive","Apple Chancery":"cursive",Courier:"monospace","Courier New":"monospace",Papyrus:"fantasy"};a=c[a]||a}this.inherited(arguments,[a,b])}}),a.declare("dijit._editor.plugins._FontSizeDropDown",b._editor.plugins._FontDropDown,{command:"fontSize",values:[1,2,3,4,5,6,7],getLabel:function(a,b){return this.plainText?b:"<font size="+a+"'>"+b+"</font>"},_setValueAttr:function(a,b){b=b!==!1?!0:!1;if(a.indexOf&&a.indexOf("px")!=-1){var c=parseInt(a,10);a=({10:1,13:2,16:3,18:4,24:5,32:6,48:7})[c]||a}this.inherited(arguments,[a,b])}}),a.declare("dijit._editor.plugins._FormatBlockDropDown",b._editor.plugins._FontDropDown,{command:"formatBlock",values:["noFormat","p","h1","h2","h3","pre"],postCreate:function(){this.inherited(arguments),this.set("value","noFormat",!1)},getLabel:function(a,b){return this.plainText||a=="noFormat"?b:"<"+a+">"+b+"</"+a+">"},_execCommand:function(c,d,e){if(e==="noFormat"){var f,g,h=b.range.getSelection(c.window);if(h&&h.rangeCount>0){var i=h.getRangeAt(0),j,k;if(i){f=i.startContainer,g=i.endContainer;while(f&&f!==c.editNode&&f!==c.document.body&&f.nodeType!==1)f=f.parentNode;while(g&&g!==c.editNode&&g!==c.document.body&&g.nodeType!==1)g=g.parentNode;var l=a.hitch(this,function(d,e){if(d.childNodes&&d.childNodes.length){var f;for(f=0;f<d.childNodes.length;f++){var g=d.childNodes[f];if(g.nodeType==1)if(a.withGlobal(c.window,"inSelection",b._editor.selection,[g])){var h=g.tagName?g.tagName.toLowerCase():"";a.indexOf(this.values,h)!==-1&&e.push(g),l(g,e)}}}}),m=a.hitch(this,function(a){if(a&&a.length){c.beginEditing();while(a.length)this._removeFormat(c,a.pop());c.endEditing()}}),n=[];if(f==g){var o;j=f;while(j&&j!==c.editNode&&j!==c.document.body){if(j.nodeType==1){k=j.tagName?j.tagName.toLowerCase():"";if(a.indexOf(this.values,k)!==-1){o=j;break}}j=j.parentNode}l(f,n),o&&(n=[o].concat(n)),m(n)}else{j=f;while(a.withGlobal(c.window,"inSelection",b._editor.selection,[j]))j.nodeType==1&&(k=j.tagName?j.tagName.toLowerCase():"",a.indexOf(this.values,k)!==-1&&n.push(j),l(j,n)),j=j.nextSibling;m(n)}c.onDisplayChanged()}}}else c.execCommand(d,e)},_removeFormat:function(c,d){if(c.customUndo){while(d.firstChild)a.place(d.firstChild,d,"before");d.parentNode.removeChild(d)}else{a.withGlobal(c.window,"selectElementChildren",b._editor.selection,[d]);var e=a.withGlobal(c.window,"getSelectedHtml",b._editor.selection,[null]);a.withGlobal(c.window,"selectElement",b._editor.selection,[d]),c.execCommand("inserthtml",e||"")}}}),a.declare("dijit._editor.plugins.FontChoice",b._editor._Plugin,{useDefaultCommand:!1,_initButton:function(){var c=({fontName:b._editor.plugins._FontNameDropDown,fontSize:b._editor.plugins._FontSizeDropDown,formatBlock:b._editor.plugins._FormatBlockDropDown})[this.command],d=this.params;this.params.custom&&(d.values=this.params.custom);var e=this.editor;this.button=new c(a.delegate({dir:e.dir,lang:e.lang},d)),this.connect(this.button.select,"onChange",function(a){this.editor.focus(),this.command=="fontName"&&a.indexOf(" ")!=-1&&(a="'"+a+"'"),this.button._execCommand?this.button._execCommand(this.editor,this.command,a):this.editor.execCommand(this.command,a)})},updateState:function(){var c=this.editor,d=this.command;if(c&&c.isLoaded&&d.length)if(this.button){var e=this.get("disabled");this.button.set("disabled",e);if(e)return;var f;try{f=c.queryCommandValue(d)||""}catch(g){f=""}var h=a.isString(f)&&f.match(/'([^']*)'/);h&&(f=h[1]);if(d==="formatBlock")if(f&&f!="p")a.indexOf(this.button.values,f)<0&&(f="noFormat");else{f=null;var i,j=b.range.getSelection(this.editor.window);if(j&&j.rangeCount>0){var k=j.getRangeAt(0);k&&(i=k.endContainer)}while(i&&i!==c.editNode&&i!==c.document){var l=i.tagName?i.tagName.toLowerCase():"";if(l&&a.indexOf(this.button.values,l)>-1){f=l;break}i=i.parentNode}f||(f="noFormat")}f!==this.button.get("value")&&this.button.set("value",f,!1)}}}),a.subscribe(b._scopeName+".Editor.getPlugin",null,function(a){if(!a.plugin)switch(a.args.name){case"fontName":case"fontSize":case"formatBlock":a.plugin=new b._editor.plugins.FontChoice({command:a.args.name,plainText:a.args.plainText?a.args.plainText:!1})}});return b._editor.plugins.FontChoice})