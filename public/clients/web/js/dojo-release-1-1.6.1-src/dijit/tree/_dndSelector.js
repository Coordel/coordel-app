define("dijit/tree/_dndSelector",["dojo","dijit","dojo/dnd/common","dijit/tree/_dndContainer"],function(a,b){a.declare("dijit.tree._dndSelector",b.tree._dndContainer,{constructor:function(c,d){this.selection={},this.anchor=null,b.setWaiState(this.tree.domNode,"multiselect",!this.singular),this.events.push(a.connect(this.tree.domNode,"onmousedown",this,"onMouseDown"),a.connect(this.tree.domNode,"onmouseup",this,"onMouseUp"),a.connect(this.tree.domNode,"onmousemove",this,"onMouseMove"))},singular:!1,getSelectedTreeNodes:function(){var a=[],b=this.selection;for(var c in b)a.push(b[c]);return a},selectNone:function(){this.setSelection([]);return this},destroy:function(){this.inherited(arguments),this.selection=this.anchor=null},addTreeNode:function(a,b){this.setSelection(this.getSelectedTreeNodes().concat([a])),b&&(this.anchor=a);return a},removeTreeNode:function(a){this.setSelection(this._setDifference(this.getSelectedTreeNodes(),[a]));return a},isTreeNodeSelected:function(a){return a.id&&!!this.selection[a.id]},setSelection:function(b){var c=this.getSelectedTreeNodes();a.forEach(this._setDifference(c,b),a.hitch(this,function(a){a.setSelected(!1),this.anchor==a&&delete this.anchor,delete this.selection[a.id]})),a.forEach(this._setDifference(b,c),a.hitch(this,function(a){a.setSelected(!0),this.selection[a.id]=a})),this._updateSelectionProperties()},_setDifference:function(b,c){a.forEach(c,function(a){a.__exclude__=!0});var d=a.filter(b,function(a){return!a.__exclude__});a.forEach(c,function(a){delete a.__exclude__});return d},_updateSelectionProperties:function(){var b=this.getSelectedTreeNodes(),c=[],d=[];a.forEach(b,function(a){d.push(a),c.push(a.getTreePath())});var e=a.map(d,function(a){return a.item});this.tree._set("paths",c),this.tree._set("path",c[0]||[]),this.tree._set("selectedNodes",d),this.tree._set("selectedNode",d[0]||null),this.tree._set("selectedItems",e),this.tree._set("selectedItem",e[0]||null)},onMouseDown:function(b){if(this.current&&!this.tree.isExpandoNode(b.target,this.current)){if(b.button==a.mouseButtons.RIGHT)return;a.stopEvent(b);var c=this.current,d=a.isCopyKey(b),e=c.id;if(this.singular||b.shiftKey||!this.selection[e])this._doDeselect=!1;else{this._doDeselect=!0;return}this.userSelect(c,d,b.shiftKey)}},onMouseUp:function(b){this._doDeselect&&(this._doDeselect=!1,this.userSelect(this.current,a.isCopyKey(b),b.shiftKey))},onMouseMove:function(a){this._doDeselect=!1},userSelect:function(a,c,d){if(this.singular)this.anchor==a&&c?this.selectNone():(this.setSelection([a]),this.anchor=a);else if(d&&this.anchor){var e=b.tree._compareNodes(this.anchor.rowNode,a.rowNode),f,g,h=this.anchor;e<0?(f=h,g=a):(f=a,g=h),nodes=[];while(f!=g)nodes.push(f),f=this.tree._getNextNode(f);nodes.push(g),this.setSelection(nodes)}else this.selection[a.id]&&c?this.removeTreeNode(a):c?this.addTreeNode(a,!0):(this.setSelection([a]),this.anchor=a)},forInSelectedItems:function(b,c){c=c||a.global;for(var d in this.selection)b.call(c,this.getItem(d),d,this)}});return b.tree._dndSelector})