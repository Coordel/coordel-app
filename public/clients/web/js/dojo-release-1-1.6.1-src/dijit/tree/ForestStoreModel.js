define("dijit/tree/ForestStoreModel",["dojo","dijit","dijit/tree/TreeStoreModel"],function(a,b){a.declare("dijit.tree.ForestStoreModel",b.tree.TreeStoreModel,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(a){this.root={store:this,root:!0,id:a.rootId,label:a.rootLabel,children:a.rootChildren}},mayHaveChildren:function(a){return a===this.root||this.inherited(arguments)},getChildren:function(b,c,d){b===this.root?this.root.children?c(this.root.children):this.store.fetch({query:this.query,onComplete:a.hitch(this,function(a){this.root.children=a,c(a)}),onError:d}):this.inherited(arguments)},isItem:function(a){return a===this.root?!0:this.inherited(arguments)},fetchItemByIdentity:function(b){if(b.identity==this.root.id){var c=b.scope?b.scope:a.global;b.onItem&&b.onItem.call(c,this.root)}else this.inherited(arguments)},getIdentity:function(a){return a===this.root?this.root.id:this.inherited(arguments)},getLabel:function(a){return a===this.root?this.root.label:this.inherited(arguments)},newItem:function(a,b,c){if(b===this.root){this.onNewRootItem(a);return this.store.newItem(a)}return this.inherited(arguments)},onNewRootItem:function(a){},pasteItem:function(a,c,d,e,f){c===this.root&&(e||this.onLeaveRoot(a)),b.tree.TreeStoreModel.prototype.pasteItem.call(this,a,c===this.root?null:c,d===this.root?null:d,e,f),d===this.root&&this.onAddToRoot(a)},onAddToRoot:function(a){console.log(this,": item ",a," added to root")},onLeaveRoot:function(a){console.log(this,": item ",a," removed from root")},_requeryTop:function(){var b=this.root.children||[];this.store.fetch({query:this.query,onComplete:a.hitch(this,function(c){this.root.children=c,(b.length!=c.length||a.some(b,function(a,b){return c[b]!=a}))&&this.onChildrenChange(this.root,c)})})},onNewItem:function(a,b){this._requeryTop(),this.inherited(arguments)},onDeleteItem:function(b){a.indexOf(this.root.children,b)!=-1&&this._requeryTop(),this.inherited(arguments)},onSetItem:function(a,b,c,d){this._requeryTop(),this.inherited(arguments)}});return b.tree.ForestStoreModel})