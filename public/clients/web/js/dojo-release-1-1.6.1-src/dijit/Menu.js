define("dijit/Menu",["dojo","dijit","text!dijit/templates/Menu.html","dojo/window","dijit/_Widget","dijit/_KeyNavContainer","dijit/_Templated","dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"],function(a,b){a.declare("dijit._MenuBase",[b._Widget,b._Templated,b._KeyNavContainer],{parentMenu:null,popupDelay:500,startup:function(){this._started||(a.forEach(this.getChildren(),function(a){a.startup()}),this.startupKeyNavChildren(),this.inherited(arguments))},onExecute:function(){},onCancel:function(a){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.focusedChild._onClick(a);else{var b=this._getTopMenu();b&&b._isMenuBar&&b.focusNext()}},_onPopupHover:function(a){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var b=this.currentPopup.parentMenu;b.focusedChild&&b.focusedChild._setSelected(!1),b.focusedChild=this.currentPopup.from_item,b.focusedChild._setSelected(!0),this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(b){this.isActive&&(this.focusChild(b),this.focusedChild.popup&&!this.focusedChild.disabled&&!this.hover_timer&&(this.hover_timer=setTimeout(a.hitch(this,"_openPopup"),this.popupDelay))),this.focusedChild&&this.focusChild(b),this._hoveredChild=b},_onChildBlur:function(a){this._stopPopupTimer(),a._setSelected(!1);var c=a.popup;c&&(this._stopPendingCloseTimer(c),c._pendingClose_timer=setTimeout(function(){c._pendingClose_timer=null,c.parentMenu&&(c.parentMenu.currentPopup=null),b.popup.close(c)},this.popupDelay))},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer(),this._hoveredChild==a&&(this._hoveredChild=null)},_stopPopupTimer:function(){this.hover_timer&&(clearTimeout(this.hover_timer),this.hover_timer=null)},_stopPendingCloseTimer:function(a){a._pendingClose_timer&&(clearTimeout(a._pendingClose_timer),a._pendingClose_timer=null)},_stopFocusTimer:function(){this._focus_timer&&(clearTimeout(this._focus_timer),this._focus_timer=null)},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){typeof this.isShowingNow=="undefined"&&this._markActive(),this.focusChild(a);if(a.disabled)return!1;a.popup?this._openPopup():(this.onExecute(),a.onClick(b))},_openPopup:function(){this._stopPopupTimer();var c=this.focusedChild;if(c){var d=c.popup;if(d.isShowingNow)return;this.currentPopup&&(this._stopPendingCloseTimer(this.currentPopup),b.popup.close(this.currentPopup)),d.parentMenu=this,d.from_item=c;var e=this;b.popup.open({parent:this,popup:d,around:c.domNode,orient:this._orient||(this.isLeftToRight()?{TR:"TL",TL:"TR",BR:"BL",BL:"BR"}:{TL:"TR",TR:"TL",BL:"BR",BR:"BL"}),onCancel:function(){e.focusChild(c),e._cleanUp(),c._setSelected(!0),e.focusedChild=c},onExecute:a.hitch(this,"_cleanUp")}),this.currentPopup=d,d.connect(d.domNode,"onmouseenter",a.hitch(e,"_onPopupHover")),d.focus&&(d._focus_timer=setTimeout(a.hitch(d,function(){this._focus_timer=null,this.focus()}),0))}},_markActive:function(){this.isActive=!0,a.replaceClass(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(a){this.isShowingNow=!0,this._markActive()},_markInactive:function(){this.isActive=!1,a.replaceClass(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer(),this._markInactive(),this.isShowingNow=!1,this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();var c=this.focusedChild&&this.focusedChild.from_item;this.currentPopup&&(b._curFocus&&a.isDescendant(b._curFocus,this.currentPopup.domNode)&&this.focusedChild.focusNode.focus(),b.popup.close(this.currentPopup),this.currentPopup=null),this.focusedChild&&(this.focusedChild._setSelected(!1),this.focusedChild._onUnhover(),this.focusedChild=null)},_onItemFocus:function(a){this._hoveredChild&&this._hoveredChild!=a&&this._hoveredChild._onUnhover()},_onBlur:function(){this._cleanUp(),this.inherited(arguments)},_cleanUp:function(){this._closeChild(),typeof this.isShowingNow=="undefined"&&this._markInactive()}}),a.declare("dijit.Menu",b._MenuBase,{constructor:function(){this._bindings=[]},templateString:a.cache("dijit","templates/Menu.html"),baseClass:"dijitMenu",targetNodeIds:[],contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(a.body()):a.forEach(this.targetNodeIds,this.bindDomNode,this);var b=a.keys,c=this.isLeftToRight();this._openSubMenuKey=c?b.RIGHT_ARROW:b.LEFT_ARROW,this._closeSubMenuKey=c?b.LEFT_ARROW:b.RIGHT_ARROW,this.connectKeyNavHandlers([b.UP_ARROW],[b.DOWN_ARROW])},_onKeyPress:function(b){if(!b.ctrlKey&&!b.altKey)switch(b.charOrCode){case this._openSubMenuKey:this._moveToPopup(b),a.stopEvent(b);break;case this._closeSubMenuKey:this.parentMenu?this.parentMenu._isMenuBar?this.parentMenu.focusPrev():this.onCancel(!1):a.stopEvent(b)}},_iframeContentWindow:function(b){var c=a.window.get(this._iframeContentDocument(b))||this._iframeContentDocument(b).__parent__||b.name&&a.doc.frames[b.name]||null;return c},_iframeContentDocument:function(b){var c=b.contentDocument||b.contentWindow&&b.contentWindow.document||b.name&&a.doc.frames[b.name]&&a.doc.frames[b.name].document||null;return c},bindDomNode:function(b){b=a.byId(b);var c;if(b.tagName.toLowerCase()=="iframe"){var d=b,e=this._iframeContentWindow(d);c=a.withGlobal(e,a.body)}else c=b==a.body()?a.doc.documentElement:b;var f={node:b,iframe:d};a.attr(b,"_dijitMenu"+this.id,this._bindings.push(f));var g=a.hitch(this,function(b){return[a.connect(b,this.leftClickToOpen?"onclick":"oncontextmenu",this,function(b){a.stopEvent(b),this._scheduleOpen(b.target,d,{x:b.pageX,y:b.pageY})}),a.connect(b,"onkeydown",this,function(b){b.shiftKey&&b.keyCode==a.keys.F10&&(a.stopEvent(b),this._scheduleOpen(b.target,d))})]});f.connects=c?g(c):[],d&&(f.onloadHandler=a.hitch(this,function(){var b=this._iframeContentWindow(d);c=a.withGlobal(b,a.body),f.connects=g(c)}),d.addEventListener?d.addEventListener("load",f.onloadHandler,!1):d.attachEvent("onload",f.onloadHandler))},unBindDomNode:function(b){var c;try{c=a.byId(b)}catch(d){return}var e="_dijitMenu"+this.id;if(c&&a.hasAttr(c,e)){var f=a.attr(c,e)-1,g=this._bindings[f];a.forEach(g.connects,a.disconnect);var h=g.iframe;h&&(h.removeEventListener?h.removeEventListener("load",g.onloadHandler,!1):h.detachEvent("onload",g.onloadHandler)),a.removeAttr(c,e),delete this._bindings[f]}},_scheduleOpen:function(b,c,d){this._openTimer||(this._openTimer=setTimeout(a.hitch(this,function(){delete this._openTimer,this._openMyself({target:b,iframe:c,coords:d})}),1))},_openMyself:function(c){function q(){o.refocus&&b.focus(p),b.popup.close(o)}var d=c.target,e=c.iframe,f=c.coords;if(f){if(e){var g=d.ownerDocument,h=a.position(e,!0),i=this._iframeContentWindow(e),j=a.withGlobal(i,"_docScroll",a),k=a.getComputedStyle(e),l=a._toPixelValue,m=(a.isIE&&a.isQuirks?0:l(e,k.paddingLeft))+(a.isIE&&a.isQuirks?l(e,k.borderLeftWidth):0),n=(a.isIE&&a.isQuirks?0:l(e,k.paddingTop))+(a.isIE&&a.isQuirks?l(e,k.borderTopWidth):0);f.x+=h.x+m-j.x,f.y+=h.y+n-j.y}}else f=a.position(d,!0),f.x+=10,f.y+=10;var o=this,p=b.getFocus(this);b.popup.open({popup:this,x:f.x,y:f.y,onExecute:q,onCancel:q,orient:this.isLeftToRight()?"L":"R"}),this.focus(),this._onBlur=function(){this.inherited("_onBlur",arguments),b.popup.close(this)}},uninitialize:function(){a.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this),this.inherited(arguments)}});return b.Menu})