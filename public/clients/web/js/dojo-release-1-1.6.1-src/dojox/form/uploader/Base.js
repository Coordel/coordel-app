define(["dojo","dijit","dijit/_Widget","dijit/_Templated"],function(a,b){a.declare("dojox.form.uploader.Base",[b._Widget,b._Templated],{getForm:function(){if(!this.form){var a=this.domNode;while(a&&a.tagName&&a!==document.body){if(a.tagName.toLowerCase()=="form"){this.form=a;break}a=a.parentNode}}return this.form},getUrl:function(){this.uploadUrl&&(this.url=this.uploadUrl);if(this.url)return this.url;this.getForm()&&(this.url=this.form.action);return this.url},connectForm:function(){this.url=this.getUrl(),!this._fcon&&!!this.getForm()&&(this._fcon=!0,this.connect(this.form,"onsubmit",function(b){a.stopEvent(b),this.submit(a.formToObject(this.form))}))},supports:function(b){this._hascache||(this._hascache={testDiv:a.create("div"),testInput:a.create("input",{type:"file"}),xhr:!window.XMLHttpRequest?{}:new XMLHttpRequest},a.style(this._hascache.testDiv,"opacity",".7"));switch(b){case"FormData":return!!window.FormData;case"sendAsBinary":return!!this._hascache.xhr.sendAsBinary;case"opacity":return a.style(this._hascache.testDiv,"opacity")==".7";case"multiple":if(this.force=="flash"||this.force=="iframe")return!1;var c=a.attr(this._hascache.testInput,"multiple");return c===!0||c===!1}return!1},getMimeType:function(){return"application/octet-stream"},getFileType:function(a){return a.substring(a.lastIndexOf(".")+1).toUpperCase()},convertBytes:function(a){var b=Math.round(a/1024*1e5)/1e5,c=Math.round(a/1048576*1e5)/1e5,d=Math.round(a/1073741824*1e5)/1e5,e=a;b>1&&(e=b.toFixed(1)+" kb"),c>1&&(e=c.toFixed(1)+" mb"),d>1&&(e=d.toFixed(1)+" gb");return{kb:b,mb:c,gb:d,bytes:a,value:e}}});return dojox.form.uploader.Base})