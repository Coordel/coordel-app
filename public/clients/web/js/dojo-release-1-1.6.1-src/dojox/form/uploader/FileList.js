define(["dojo","dijit","dojox/form/uploader/Base"],function(a,b){a.declare("dojox.form.uploader.FileList",[dojox.form.uploader.Base],{uploaderId:"",uploader:null,headerIndex:"#",headerType:"Type",headerFilename:"File Name",headerFilesize:"Size",_upCheckCnt:0,rowAmt:0,templateString:'<div class="dojoxUploaderFileList"><div dojoAttachPoint="progressNode" class="dojoxUploaderFileListProgress"><div dojoAttachPoint="percentBarNode" class="dojoxUploaderFileListProgressBar"></div><div dojoAttachPoint="percentTextNode" class="dojoxUploaderFileListPercentText">0%</div></div><table class="dojoxUploaderFileListTable"><tr class="dojoxUploaderFileListHeader"><th class="dojoxUploaderIndex">${headerIndex}</th><th class="dojoxUploaderIcon">${headerType}</th><th class="dojoxUploaderFileName">${headerFilename}</th><th class="dojoxUploaderFileSize">${headerFilesize}</th></tr><tr ><td colSpan="4" class="dojoxUploaderFileListContainer" dojoAttachPoint="containerNode"><table class="dojoxUploaderFileListContent" dojoAttachPoint="listNode"></table></td><tr></table><div>',postCreate:function(){this.setUploader(),this.hideProgress()},reset:function(){for(var a=0;a<this.rowAmt;a++)this.listNode.deleteRow(0);this.rowAmt=0},setUploader:function(){if(this.uploaderId||this.uploader){if(this.uploaderId&&!this.uploader)this.uploader=b.byId(this.uploaderId);else if(this._upCheckCnt>4){console.warn("uploader not found for ID ",this.uploaderId);return}}else console.warn("uploaderId not passed to UploaderFileList");this.uploader?(this.connect(this.uploader,"onChange","_onUploaderChange"),this.connect(this.uploader,"reset","reset"),this.connect(this.uploader,"onBegin",function(){this.showProgress(!0)}),this.connect(this.uploader,"onProgress","_progress"),this.connect(this.uploader,"onComplete",function(){setTimeout(a.hitch(this,function(){this.hideProgress(!0)}),1250)})):(this._upCheckCnt++,setTimeout(a.hitch(this,"setUploader"),250))},hideProgress:function(a){var b=a?{ani:!0,endDisp:"none",beg:15,end:0}:{endDisp:"none",ani:!1};this._hideShowProgress(b)},showProgress:function(a){var b=a?{ani:!0,endDisp:"block",beg:0,end:15}:{endDisp:"block",ani:!1};this._hideShowProgress(b)},_progress:function(b){this.percentTextNode.innerHTML=b.percent,a.style(this.percentBarNode,"width",b.percent)},_hideShowProgress:function(b){var c=this.progressNode,d=function(){a.style(c,"display",b.endDisp)};b.ani?(a.style(c,"display","block"),a.animateProperty({node:c,properties:{height:{start:b.beg,end:b.end,units:"px"}},onEnd:d}).play()):d()},_onUploaderChange:function(b){this.reset(),a.forEach(b,function(a,b){this._addRow(b+1,this.getFileType(a.name),a.name,a.size)},this)},_addRow:function(b,c,d,e){var f,g=this.listNode.insertRow(-1);f=g.insertCell(-1),a.addClass(f,"dojoxUploaderIndex"),f.innerHTML=b,f=g.insertCell(-1),a.addClass(f,"dojoxUploaderIcon"),f.innerHTML=c,f=g.insertCell(-1),a.addClass(f,"dojoxUploaderFileName"),f.innerHTML=d,f=g.insertCell(-1),a.addClass(f,"dojoxUploaderSize"),f.innerHTML=this.convertBytes(e).value,this.rowAmt++}});return dojox.form.uploader.FileList})