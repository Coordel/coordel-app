dojo.provide("dojox.form.manager._NodeMixin"),dojo.require("dojox.form.manager._Mixin"),function(){var a=dojox.form.manager,b=a.actionAdapter,c=a._keys,d=a.changeEvent=function(a){var b="onclick";switch(a.tagName.toLowerCase()){case"textarea":b="onkeyup";break;case"select":b="onchange";break;case"input":switch(a.type.toLowerCase()){case"text":case"password":b="onkeyup"}}return b},e=function(a,b){var c=dojo.attr(a,"name");b=b||this.domNode;if(!c||c in this.formWidgets)c=null;else{for(var d=a;d&&d!==b;d=d.parentNode)if(dojo.attr(d,"widgetId")&&dijit.byNode(d)instanceof dijit.form._FormWidget)return null;if(a.tagName.toLowerCase()=="input"&&a.type.toLowerCase()=="radio"){var e=this.formNodes[c];e=e&&e.node,e&&dojo.isArray(e)?e.push(a):this.formNodes[c]={node:[a],connections:[]}}else this.formNodes[c]={node:a,connections:[]}}return c},f=function(a){var d={};b(function(a,b){var c=dojo.attr(b,"observer");c&&typeof c=="string"&&dojo.forEach(c.split(","),function(a){a=dojo.trim(a),a&&dojo.isFunction(this[a])&&(d[a]=1)},this)}).call(this,null,this.formNodes[a].node);return c(d)},g=function(a,c){var e=this.formNodes[a],f=e.connections;f.length&&(dojo.forEach(f,dojo.disconnect),f=e.connections=[]),b(function(b,e){var g=d(e);dojo.forEach(c,function(b){f.push(dojo.connect(e,g,this,function(c){this.watching&&this[b](this.formNodeValue(a),a,e,c)}))},this)}).call(this,null,e.node)};dojo.declare("dojox.form.manager._NodeMixin",null,{destroy:function(){for(var a in this.formNodes)dojo.forEach(this.formNodes[a].connections,dojo.disconnect);this.formNodes={},this.inherited(arguments)},registerNode:function(a){typeof a=="string"&&(a=dojo.byId(a));var b=e.call(this,a);b&&g.call(this,b,f.call(this,b));return this},unregisterNode:function(a){a in this.formNodes&&(dojo.forEach(this.formNodes[a].connections,this.disconnect,this),delete this.formNodes[a]);return this},registerNodeDescendants:function(a){typeof a=="string"&&(a=dojo.byId(a)),dojo.query("input, select, textarea, button",a).map(function(b){return e.call(this,b,a)},this).forEach(function(a){a&&g.call(this,a,f.call(this,a))},this);return this},unregisterNodeDescendants:function(a){typeof a=="string"&&(a=dojo.byId(a)),dojo.query("input, select, textarea, button",a).map(function(b){return dojo.attr(a,"name")||null}).forEach(function(a){a&&this.unregisterNode(a)},this);return this},formNodeValue:function(a,b){var c=arguments.length==2&&b!==undefined,d;typeof a=="string"&&(a=this.formNodes[a],a&&(a=a.node));if(!a)return null;if(dojo.isArray(a)){if(c){dojo.forEach(a,function(a){a.checked=""}),dojo.forEach(a,function(a){a.checked=a.value===b?"checked":""});return this}dojo.some(a,function(a){if(a.checked){d=a;return!0}return!1});return d?d.value:""}switch(a.tagName.toLowerCase()){case"select":if(a.multiple){if(c){if(dojo.isArray(b)){var e={};dojo.forEach(b,function(a){e[a]=1}),dojo.query("> option",a).forEach(function(a){a.selected=a.value in e});return this}dojo.query("> option",a).forEach(function(a){a.selected=a.value===b});return this}var d=dojo.query("> option",a).filter(function(a){return a.selected}).map(function(a){return a.value});return d.length==1?d[0]:d}if(c){dojo.query("> option",a).forEach(function(a){a.selected=a.value===b});return this}return a.value||"";case"button":if(c){a.innerHTML=""+b;return this}return a.innerHTML;case"input":if(a.type.toLowerCase()=="checkbox"){if(c){a.checked=b?"checked":"";return this}return Boolean(a.checked)}}if(c){a.value=""+b;return this}return a.value},inspectFormNodes:function(a,b,c){var d,e={};if(b)if(dojo.isArray(b))dojo.forEach(b,function(b){b in this.formNodes&&(e[b]=a.call(this,b,this.formNodes[b].node,c))},this);else for(d in b)d in this.formNodes&&(e[d]=a.call(this,d,this.formNodes[d].node,b[d]));else for(d in this.formNodes)e[d]=a.call(this,d,this.formNodes[d].node,c);return e}})}()