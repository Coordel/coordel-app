dojo.provide("dojox.form.FileInputAuto"),dojo.require("dojox.form.FileInput"),dojo.require("dojo.io.iframe"),dojo.declare("dojox.form.FileInputAuto",dojox.form.FileInput,{url:"",blurDelay:2e3,duration:500,uploadMessage:"Uploading ...",triggerEvent:"onblur",_sent:!1,templateString:dojo.cache("dojox.form","resources/FileInputAuto.html"),onBeforeSend:function(){return{}},startup:function(){this._blurListener=this.connect(this.fileInput,this.triggerEvent,"_onBlur"),this._focusListener=this.connect(this.fileInput,"onfocus","_onFocus"),this.inherited(arguments)},_onFocus:function(){this._blurTimer&&clearTimeout(this._blurTimer)},_onBlur:function(){this._blurTimer&&clearTimeout(this._blurTimer),this._sent||(this._blurTimer=setTimeout(dojo.hitch(this,"_sendFile"),this.blurDelay))},setMessage:function(a){this.overlay.removeChild(this.overlay.firstChild),this.overlay.appendChild(document.createTextNode(a))},_sendFile:function(a){if(!this._sent&&!this._sending&&this.fileInput.value){this._sending=!0,dojo.style(this.fakeNodeHolder,"display","none"),dojo.style(this.overlay,{opacity:0,display:"block"}),this.setMessage(this.uploadMessage),dojo.fadeIn({node:this.overlay,duration:this.duration}).play();var b;dojo.isIE<9||dojo.isIE&&dojo.isQuirks?(b=document.createElement('<form enctype="multipart/form-data" method="post">'),b.encoding="multipart/form-data"):(b=document.createElement("form"),b.setAttribute("enctype","multipart/form-data")),b.appendChild(this.fileInput),dojo.body().appendChild(b),dojo.io.iframe.send({url:this.url,form:b,handleAs:"json",handle:dojo.hitch(this,"_handleSend"),content:this.onBeforeSend()})}},_handleSend:function(a,b){this.overlay.removeChild(this.overlay.firstChild),this._sent=!0,this._sending=!1,dojo.style(this.overlay,{opacity:0,border:"none",background:"none"}),this.overlay.style.backgroundImage="none",this.fileInput.style.display="none",this.fakeNodeHolder.style.display="none",dojo.fadeIn({node:this.overlay,duration:this.duration}).play(250),this.disconnect(this._blurListener),this.disconnect(this._focusListener),dojo.body().removeChild(b.args.form),this.fileInput=null,this.onComplete(a,b,this)},reset:function(a){this._blurTimer&&clearTimeout(this._blurTimer),this.disconnect(this._blurListener),this.disconnect(this._focusListener),this.overlay.style.display="none",this.fakeNodeHolder.style.display="",this.inherited(arguments),this._sent=!1,this._sending=!1,this._blurListener=this.connect(this.fileInput,this.triggerEvent,"_onBlur"),this._focusListener=this.connect(this.fileInput,"onfocus","_onFocus")},onComplete:function(a,b,c){}}),dojo.declare("dojox.form.FileInputBlind",dojox.form.FileInputAuto,{startup:function(){this.inherited(arguments),this._off=dojo.style(this.inputNode,"width"),this.inputNode.style.display="none",this._fixPosition()},_fixPosition:function(){dojo.isIE?dojo.style(this.fileInput,"width","1px"):dojo.style(this.fileInput,"left","-"+this._off+"px")},reset:function(a){this.inherited(arguments),this._fixPosition()}})