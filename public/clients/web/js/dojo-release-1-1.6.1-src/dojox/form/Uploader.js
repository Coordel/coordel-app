define(["dojo","dijit","dojox/form/uploader/Base","dijit/form/Button"],function(a,b){a.experimental("dojox.form.Uploader"),a.declare("dojox.form.Uploader",[dojox.form.uploader.Base],{uploadOnSelect:!1,tabIndex:0,multiple:!1,label:"Upload...",url:"",name:"uploadedfile",flashFieldName:"",uploadType:"form",_nameIndex:0,widgetsInTemplate:!0,templateString:'<div class="dojoxFileInput"><div dojoType="dijit.form.Button" dojoAttachPoint="button">${label}</div></div>',postMixInProperties:function(){this._inputs=[],this._getButtonStyle(this.srcNodeRef),this.inherited(arguments)},postCreate:function(){var b=!1,c=this.domNode.parentNode,d=this._getNodePosition(this.domNode);if(!this.btnSize.w||!this.btnSize.h)a.body().appendChild(this.domNode),this._getButtonStyle(this.domNode),b=!0;this._setButtonStyle(),b&&a.place(this.domNode,d.node,d.pos),this.inherited(arguments)},onChange:function(a){},onBegin:function(a){},onProgress:function(a){},onComplete:function(a){this.reset()},onCancel:function(){},onAbort:function(){},onError:function(a){},upload:function(a){},submit:function(a){},reset:function(){this._disconnectButton(),a.forEach(this._inputs,a.destroy,a),this._inputs=[],this._nameIndex=0,this._createInput()},getFileList:function(){var b=[];this.supports("multiple")?a.forEach(this.inputNode.files,function(a,c){b.push({index:c,name:a.name,size:a.size,type:a.type})},this):a.forEach(this._inputs,function(a,c){b.push({index:c,name:a.value.substring(a.value.lastIndexOf("\\")+1),size:0,type:a.value.substring(a.value.lastIndexOf(".")+1)})},this);return b},_getValueAttr:function(){return this.getFileList()},_setValueAttr:function(a){console.error("Uploader value is read only")},_getDisabledAttr:function(){return this._disabled},_setDisabledAttr:function(b){this._disabled!=b&&(this.button.set("disabled",b),a.style(this.inputNode,"display",b?"none":"block"))},_getNodePosition:function(a){if(a.previousSibling)return{node:a.previousSibling,pos:"after"};return{node:a.nextSibling,pos:"before"}},_getButtonStyle:function(b){b?this.btnSize=a.marginBox(b):this.btnSize={w:200,h:25}},_setButtonStyle:function(){var b=!0;if(!this.domNode.parentNode||!this.domNode.parentNode.tagName)document.body.appendChild(this.domNode),b=!1;a.style(this.domNode,{width:this.btnSize.w+"px",height:this.btnSize.h+4+"px",overflow:"hidden",position:"relative"}),this.inputNodeFontSize=Math.max(2,Math.max(Math.ceil(this.btnSize.w/60),Math.ceil(this.btnSize.h/15))),this._createInput(),a.style(this.button.domNode,{margin:"0px",display:"block",verticalAlign:"top"}),a.style(this.button.domNode.firstChild,{margin:"0px",display:"block"}),b||document.body.removeChild(this.domNode)},_createInput:function(){this._inputs.length&&(a.style(this.inputNode,{top:"500px"}),this._disconnectButton(),this._nameIndex++);var b;this.supports("multiple")?b=this.name+"s[]":b=this.name+(this.multiple?this._nameIndex:""),this.inputNode=a.create("input",{type:"file",name:b,className:"dojoxInputNode"},this.domNode,"first"),this.supports("multiple")&&this.multiple&&a.attr(this.inputNode,"multiple",!0),this._inputs.push(this.inputNode),a.style(this.inputNode,{fontSize:this.inputNodeFontSize+"em"});var c=a.marginBox(this.inputNode);a.style(this.inputNode,{position:"absolute",top:"-2px",left:"-"+(c.w-this.btnSize.w-2)+"px",opacity:0}),this._connectButton()},_connectButton:function(){this._cons=[];var b=a.hitch(this,function(b){this._cons.push(a.connect(this.inputNode,b,this,function(a){this.button._cssMouseEvent({type:b})}))});b("mouseover"),b("mouseout"),b("mousedown"),this._cons.push(a.connect(this.inputNode,"change",this,function(a){this.onChange(this.getFileList(a)),!this.supports("multiple")&&this.multiple&&this._createInput()})),this.button.set("tabIndex",-1);if(this.tabIndex>-1){this.inputNode.tabIndex=this.tabIndex;var c=a.style(this.button.domNode.firstChild,"border");this._cons.push(a.connect(this.inputNode,"focus",this,function(){a.style(this.button.domNode.firstChild,"border","1px dashed #ccc")})),this._cons.push(a.connect(this.inputNode,"blur",this,function(){a.style(this.button.domNode.firstChild,"border",c)}))}},_disconnectButton:function(){a.forEach(this._cons,a.disconnect,a)}}),dojox.form.UploaderOrg=dojox.form.Uploader;var c=[dojox.form.UploaderOrg];dojox.form.addUploaderPlugin=function(b){c.push(b),a.declare("dojox.form.Uploader",c,{})};return dojox.form.Uploader})