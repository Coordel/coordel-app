dojo.provide("dojox.form._SelectStackMixin"),dojo.declare("dojox.form._SelectStackMixin",null,{stackId:"",stackPrefix:"",_paneIdFromOption:function(a){return(this.stackPrefix||"")+a},_optionValFromPane:function(a){var b=this.stackPrefix;if(b&&a.indexOf(b)===0)return a.substring(b.length);return a},_togglePane:function(a,b){if(a._shown==undefined||a._shown!=b){var c=dojo.filter(a.getDescendants(),"return item.name;");if(b){var d=a._savedStates||{};dojo.forEach(c,function(a){var b=d[a.id];b==undefined&&(b=!1),a.set("disabled",b)}),delete a._savedStates}else d={},dojo.forEach(c,function(a){d[a.id]=a.disabled,a.set("disabled",!0)}),a._savedStates=d;a._shown=b}},_connectTitle:function(a,b){var c=dojo.hitch(this,function(a){this.updateOption({value:b,label:a})});a._setTitleAttr?this.connect(a,"_setTitleAttr",c):this.connect(a,"attr",function(a,b){a=="title"&&arguments.length>1&&c(b)})},onAddChild:function(a,b){if(!this._panes[a.id]){this._panes[a.id]=a;var c=this._optionValFromPane(a.id);this.addOption({value:c,label:a.title}),this._connectTitle(a,c)}if(!a.onShow||!a.onHide||a._shown==undefined)a.onShow=dojo.hitch(this,"_togglePane",a,!0),a.onHide=dojo.hitch(this,"_togglePane",a,!1),a.onHide()},_setValueAttr:function(a){"_savedValue"in this||this.inherited(arguments)},attr:function(a,b){a=="value"&&arguments.length==2&&"_savedValue"in this&&(this._savedValue=b);return this.inherited(arguments)},onRemoveChild:function(a){this._panes[a.id]&&(delete this._panes[a.id],this.removeOption(this._optionValFromPane(a.id)))},onSelectChild:function(a){this._setValueAttr(this._optionValFromPane(a.id))},onStartup:function(a){var b=a.selected;this.addOption(dojo.filter(dojo.map(a.children,function(a){var c=this._optionValFromPane(a.id);this._connectTitle(a,c);var d=null;this._panes[a.id]||(this._panes[a.id]=a,d={value:c,label:a.title});if(!a.onShow||!a.onHide||a._shown==undefined)a.onShow=dojo.hitch(this,"_togglePane",a,!0),a.onHide=dojo.hitch(this,"_togglePane",a,!1),a.onHide();"_savedValue"in this&&c===this._savedValue&&(b=a);return d},this),function(a){return a}));var c=this,d=function(){delete c._savedValue,c.onSelectChild(b),b._shown||c._togglePane(b,!0)};if(b!==a.selected)var e=dijit.byId(this.stackId),f=this.connect(e,"_showChild",function(a){this.disconnect(f),d()});else d()},postMixInProperties:function(){this._savedValue=this.value,this.inherited(arguments),this.connect(this,"onChange","_handleSelfOnChange")},postCreate:function(){this.inherited(arguments),this._panes={},this._subscriptions=[dojo.subscribe(this.stackId+"-startup",this,"onStartup"),dojo.subscribe(this.stackId+"-addChild",this,"onAddChild"),dojo.subscribe(this.stackId+"-removeChild",this,"onRemoveChild"),dojo.subscribe(this.stackId+"-selectChild",this,"onSelectChild")];var a=dijit.byId(this.stackId);a&&a._started&&this.onStartup({children:a.getChildren(),selected:a.selectedChildWidget})},destroy:function(){dojo.forEach(this._subscriptions,dojo.unsubscribe),delete this._panes,this.inherited("destroy",arguments)},_handleSelfOnChange:function(a){var b=this._panes[this._paneIdFromOption(a)];if(b){var c=dijit.byId(this.stackId);b==c.selectedChildWidget?c._transition(b):c.selectChild(b)}}})