define("dojo/dnd/Container",["dojo","dojo/dnd/common","dojo/parser"],function(a){a.declare("dojo.dnd.Container",null,{skipForm:!1,constructor:function(b,c){this.node=a.byId(b),c||(c={}),this.creator=c.creator||null,this.skipForm=c.skipForm,this.parent=c.dropParent&&a.byId(c.dropParent),this.map={},this.current=null,this.containerState="",a.addClass(this.node,"dojoDndContainer"),(!c||!c._skipStartup)&&this.startup(),this.events=[a.connect(this.node,"onmouseover",this,"onMouseOver"),a.connect(this.node,"onmouseout",this,"onMouseOut"),a.connect(this.node,"ondragstart",this,"onSelectStart"),a.connect(this.node,"onselectstart",this,"onSelectStart")]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(b,c){c=c||a.global;var d=this.map,e=a.dnd._empty;for(var f in d){if(f in e)continue;b.call(c,d[f],f,this)}return c},clearItems:function(){this.map={}},getAllNodes:function(){return a.query("> .dojoDndItem",this.parent)},sync:function(){var b={};this.getAllNodes().forEach(function(c){if(c.id){var d=this.getItem(c.id);if(d){b[c.id]=d;return}}else c.id=a.dnd.getUniqueId();var e=c.getAttribute("dndType"),f=c.getAttribute("dndData");b[c.id]={data:f||c.innerHTML,type:e?e.split(/\s*,\s*/):["text"]}},this),this.map=b;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;if(c)for(var d=0;d<a.length;++d){var e=this._normalizedCreator(a[d]);this.setItem(e.node.id,{data:e.data,type:e.type}),this.parent.insertBefore(e.node,c)}else for(var d=0;d<a.length;++d){var e=this._normalizedCreator(a[d]);this.setItem(e.node.id,{data:e.data,type:e.type}),this.parent.appendChild(e.node)}return this},destroy:function(){a.forEach(this.events,a.disconnect),this.clearItems(),this.node=this.parent=this.current=null},markupFactory:function(b,c){b._skipStartup=!0;return new a.dnd.Container(c,b)},startup:function(){if(!this.parent){this.parent=this.node;if(this.parent.tagName.toLowerCase()=="table"){var b=this.parent.getElementsByTagName("tbody");b&&b.length&&(this.parent=b[0])}}this.defaultCreator=a.dnd._defaultCreator(this.parent),this.sync()},onMouseOver:function(a){var b=a.relatedTarget;while(b){if(b==this.node)break;try{b=b.parentNode}catch(c){b=null}}b||(this._changeState("Container","Over"),this.onOverEvent()),b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(var b=a.relatedTarget;b;){if(b==this.node)return;try{b=b.parentNode}catch(c){b=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null),this._changeState("Container",""),this.onOutEvent()},onSelectStart:function(b){(!this.skipForm||!a.dnd.isFormElement(b))&&a.stopEvent(b)},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(b,c){var d="dojoDnd"+b,e=b.toLowerCase()+"State";a.replaceClass(this.node,d+c,d+this[e]),this[e]=c},_addItemClass:function(b,c){a.addClass(b,"dojoDndItem"+c)},_removeItemClass:function(b,c){a.removeClass(b,"dojoDndItem"+c)},_getChildByEvent:function(b){var c=b.target;if(c)for(var d=c.parentNode;d;c=d,d=c.parentNode)if(d==this.parent&&a.hasClass(c,"dojoDndItem"))return c;return null},_normalizedCreator:function(b,c){var d=(this.creator||this.defaultCreator).call(this,b,c);a.isArray(d.type)||(d.type=["text"]),d.node.id||(d.node.id=a.dnd.getUniqueId()),a.addClass(d.node,"dojoDndItem");return d}}),a.dnd._createNode=function(b){if(!b)return a.dnd._createSpan;return function(c){return a.create(b,{innerHTML:c})}},a.dnd._createTrTd=function(b){var c=a.create("tr");a.create("td",{innerHTML:b},c);return c},a.dnd._createSpan=function(b){return a.create("span",{innerHTML:b})},a.dnd._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"},a.dnd._defaultCreator=function(b){var c=b.tagName.toLowerCase(),d=c=="tbody"||c=="thead"?a.dnd._createTrTd:a.dnd._createNode(a.dnd._defaultCreatorNodes[c]);return function(b,c){var e=b&&a.isObject(b),f,g,h;e&&b.tagName&&b.nodeType&&b.getAttribute?(f=b.getAttribute("dndData")||b.innerHTML,g=b.getAttribute("dndType"),g=g?g.split(/\s*,\s*/):["text"],h=b):(f=e&&b.data?b.data:b,g=e&&b.type?b.type:["text"],h=(c=="avatar"?a.dnd._createSpan:d)(String(f))),h.id||(h.id=a.dnd.getUniqueId());return{node:h,data:f,type:g}}};return a.dnd.Container})