define("dojo/dnd/Selector",["dojo","dojo/dnd/common","dojo/dnd/Container"],function(a){a.declare("dojo.dnd.Selector",a.dnd.Container,{constructor:function(b,c){c||(c={}),this.singular=c.singular,this.autoSync=c.autoSync,this.selection={},this.anchor=null,this.simpleSelection=!1,this.events.push(a.connect(this.node,"onmousedown",this,"onMouseDown"),a.connect(this.node,"onmouseup",this,"onMouseUp"))},singular:!1,getSelectedNodes:function(){var b=new a.NodeList,c=a.dnd._empty;for(var d in this.selection){if(d in c)continue;b.push(a.byId(d))}return b},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(b,c){this._addItemClass(a.byId(c),"Selected"),this.selection[c]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var b=a.dnd._empty;for(var c in this.selection){if(c in b)continue;var d=a.byId(c);this.delItem(c),a.destroy(d)}this.anchor=null,this.selection={};return this},forInSelectedItems:function(b,c){c=c||a.global;var d=this.selection,e=a.dnd._empty;for(var f in d){if(f in e)continue;b.call(c,this.getItem(f),f,this)}},sync:function(){a.dnd.Selector.superclass.sync.call(this),this.anchor&&(this.getItem(this.anchor.id)||(this.anchor=null));var b=[],c=a.dnd._empty;for(var d in this.selection){if(d in c)continue;this.getItem(d)||b.push(d)}a.forEach(b,function(a){delete this.selection[a]},this);return this},insertNodes:function(b,c,d,e){var f=this._normalizedCreator;this._normalizedCreator=function(a,c){var d=f.call(this,a,c);b?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d},a.dnd.Selector.superclass.insertNodes.call(this,c,d,e),this._normalizedCreator=f;return this},destroy:function(){a.dnd.Selector.superclass.destroy.call(this),this.selection=this.anchor=null},markupFactory:function(b,c){b._skipStartup=!0;return new a.dnd.Selector(c,b)},onMouseDown:function(b){this.autoSync&&this.sync();if(this.current){if(!this.singular&&!a.isCopyKey(b)&&!b.shiftKey&&this.current.id in this.selection){this.simpleSelection=!0,b.button===a.mouseButtons.LEFT&&a.stopEvent(b);return}if(!this.singular&&b.shiftKey){a.isCopyKey(b)||this._removeSelection();var c=this.getAllNodes();if(c.length){this.anchor||(this.anchor=c[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1;if(this.anchor!=this.current){var d=0;for(;d<c.length;++d){var e=c[d];if(e==this.anchor||e==this.current)break}for(++d;d<c.length;++d){var e=c[d];if(e==this.anchor||e==this.current)break;this._addItemClass(e,"Selected"),this.selection[e.id]=1}this._addItemClass(this.current,"Selected"),this.selection[this.current.id]=1}}}else this.singular?this.anchor==this.current?a.isCopyKey(b)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):a.isCopyKey(b)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopEvent(b)}},onMouseUp:function(a){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(a){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=a.connect(this.node,"onmousemove",this,"onMouseMove")},onOutEvent:function(){a.disconnect(this.onmousemoveEvent),delete this.onmousemoveEvent},_removeSelection:function(){var b=a.dnd._empty;for(var c in this.selection){if(c in b)continue;var d=a.byId(c);d&&this._removeItemClass(d,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return a.dnd.Selector})