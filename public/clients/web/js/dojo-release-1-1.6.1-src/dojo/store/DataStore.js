define("dojo/store/DataStore",["dojo","dojo/store/util/QueryResults"],function(a){a.declare("dojo.store.DataStore",null,{target:"",constructor:function(b){a.mixin(this,b)},_objectConverter:function(a){var b=this.store;return function(c){var d={},e=b.getAttributes(c);for(var f=0;f<e.length;f++)d[e[f]]=b.getValue(c,e[f]);return a(d)}},get:function(b,c){var d,e,f=new a.Deferred;this.store.fetchItemByIdentity({identity:b,onItem:this._objectConverter(function(a){f.resolve(d=a)}),onError:function(a){f.reject(e=a)}});if(d)return d;if(e)throw e;return f.promise},put:function(a,b){var c=b&&typeof b.id!="undefined"||this.getIdentity(a),d=this.store;typeof c=="undefined"?d.newItem(a):d.fetchItemByIdentity({identity:c,onItem:function(b){if(b)for(var c in a)d.getValue(b,c)!=a[c]&&d.setValue(b,c,a[c]);else d.newItem(a)}})},remove:function(a){var b=this.store;this.store.fetchItemByIdentity({identity:a,onItem:function(a){b.deleteItem(a)}})},query:function(b,c){var d,e,f=new a.Deferred;f.total=new a.Deferred;var g=this._objectConverter(function(a){return a});this.store.fetch(a.mixin({query:b,onBegin:function(a){f.total.resolve(a)},onComplete:function(b){f.resolve(a.map(b,g))},onError:function(a){f.reject(a)}},c));return a.store.util.QueryResults(f)},getIdentity:function(a){return a[this.idProperty||this.store.getIdentityAttributes()[0]]}});return a.store.DataStore})