define("dojo/back",["dojo"],function(a){a.getObject("back",!0,a),function(){function u(){if(!n){var a=l.length,b=c();if((b===f||window.location.href==e)&&a==1){p();return}if(k.length>0)if(k[k.length-1].urlHash===b){q();return}if(a>=2&&l[a-2])if(l[a-2].urlHash===b){p();return}}}function t(){var b=(a.config.dojoIframeHistoryUrl||a.moduleUrl("dojo","resources/iframe_history.html"))+"?"+(new Date).getTime();m=!0,j&&(a.isWebKit?j.location=b:window.frames[j.name].location=b);return b}function s(a){var b=a.split("?");return b.length<2?null:b[1]}function r(a,b,c){return{url:a,kwArgs:b,urlHash:c}}function q(){var a=k.pop();a&&(a.kwArgs.forward?a.kwArgs.forward():a.kwArgs.forwardButton?a.kwArgs.forwardButton():a.kwArgs.handle&&a.kwArgs.handle("forward"),l.push(a))}function p(){var a=l.pop();if(a){var b=l[l.length-1];!b&&l.length==0&&(b=g),b&&(b.kwArgs.back?b.kwArgs.back():b.kwArgs.backButton?b.kwArgs.backButton():b.kwArgs.handle&&b.kwArgs.handle("back")),k.push(a)}}var b=a.back,c=b.getHash=function(){var b=window.location.hash;b.charAt(0)=="#"&&(b=b.substring(1));return a.isMozilla?b:decodeURIComponent(b)},d=b.setHash=function(a){a||(a=""),window.location.hash=encodeURIComponent(a),o=history.length},e=typeof window!=="undefined"?window.location.href:"",f=typeof window!=="undefined"?c():"",g=null,h=null,i=null,j=null,k=[],l=[],m=!1,n=!1,o;b.goBack=p,b.goForward=q,b.init=function(){if(!a.byId("dj_history")){var b=a.config.dojoIframeHistoryUrl||a.moduleUrl("dojo","resources/iframe_history.html");a._postLoad?console.error("dojo.back.init() must be called before the DOM has loaded. If using xdomain loading or djConfig.debugAtAllCosts, include dojo.back in a build layer."):document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+b+'"></iframe>')}},b.setInitialState=function(a){g=r(e,a,f)},b.addToHistory=function(b){k=[];var e=null,f=null;j||(a.config.useXDomain&&!a.config.dojoIframeHistoryUrl&&console.warn("dojo.back: When using cross-domain Dojo builds, please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl to the path on your domain to iframe_history.html"),j=window.frames.dj_history),i||(i=a.create("a",{style:{display:"none"}},a.body()));if(b.changeUrl){e=""+(b.changeUrl!==!0?b.changeUrl:(new Date).getTime());if(l.length==0&&g.urlHash==e){g=r(f,b,e);return}if(l.length>0&&l[l.length-1].urlHash==e){l[l.length-1]=r(f,b,e);return}n=!0,setTimeout(function(){d(e),n=!1},1),i.href=e;if(a.isIE){f=t();var m=b.back||b.backButton||b.handle,o=function(a){c()!=""&&setTimeout(function(){d(e)},1),m.apply(this,[a])};b.back?b.back=o:b.backButton?b.backButton=o:b.handle&&(b.handle=o);var p=b.forward||b.forwardButton||b.handle,q=function(a){c()!=""&&d(e),p&&p.apply(this,[a])};b.forward?b.forward=q:b.forwardButton?b.forwardButton=q:b.handle&&(b.handle=q)}else a.isIE||(h||(h=setInterval(u,200)))}else f=t();l.push(r(f,b,e))},b._iframeLoaded=function(a,b){var c=s(b.href);if(c==null)l.length==1&&p();else{if(m){m=!1;return}l.length<2||c!=s(l[l.length-2].url)?k.length>0&&c==s(k[k.length-1].url)&&q():p()}}}();return a.back})