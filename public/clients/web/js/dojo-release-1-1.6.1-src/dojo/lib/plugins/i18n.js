define(["dojo"],function(a){var b=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/,c=function(a,b,c,d){for(var e=[c+d],f=b.split("-"),g="",h=0;h<f.length;h++)g+=f[h],a[g]&&e.push(c+g+"/"+d);return e},d={};return{load:function(e,f,g){var h=b.exec(e),i=f.toAbsMid&&f.toAbsMid(h[1])||h[1],j=h[5]||h[4],k=i+j,l=h[5]&&h[4]||a.locale,m=k+"/"+l;d[m]?g(d[m]):f([k],function(b){var e=d[k+"/"]=a.clone(b.root),h=c(b,l,i,j);f(h,function(){for(var b=1;b<h.length;b++)d[k+"/"+h[b]]=e=a.mixin(a.clone(e),arguments[b]);d[m]=e,g(e)})})},cache:function(a,b){d[a]=b}}})