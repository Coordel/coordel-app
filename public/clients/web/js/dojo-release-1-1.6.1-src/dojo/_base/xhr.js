define("dojo/_base/xhr",["dojo/lib/kernel","dojo/_base/Deferred","dojo/_base/json","dojo/_base/lang","dojo/_base/query"],function(a){(function(){function d(a,c,d){if(d!==null){var e=a[c];typeof e=="string"?a[c]=[e,d]:b.isArray(e)?e.push(d):a[c]=d}}var b=a,c=b.config;a.fieldToObject=function(a){var c=null,d=b.byId(a);if(d){var e=d.name,f=(d.type||"").toLowerCase();e&&f&&!d.disabled&&(f=="radio"||f=="checkbox"?d.checked&&(c=d.value):d.multiple?(c=[],b.query("option",d).forEach(function(a){a.selected&&c.push(a.value)})):c=d.value)}return c},a.formToObject=function(c){var e={},f="file|submit|image|reset|button|";b.forEach(a.byId(c).elements,function(a){var c=a.name,g=(a.type||"").toLowerCase();c&&g&&f.indexOf(g)==-1&&!a.disabled&&(d(e,c,b.fieldToObject(a)),g=="image"&&(e[c+".x"]=e[c+".y"]=e[c].x=e[c].y=0))});return e},a.objectToQuery=function(a){var c=encodeURIComponent,d=[],e={};for(var f in a){var g=a[f];if(g!=e[f]){var h=c(f)+"=";if(b.isArray(g))for(var i=0;i<g.length;i++)d.push(h+c(g[i]));else d.push(h+c(g))}}return d.join("&")},a.formToQuery=function(a){return b.objectToQuery(b.formToObject(a))},a.formToJson=function(a,c){return b.toJson(b.formToObject(a),c)},a.queryToObject=function(a){var c={},d=a.split("&"),e=decodeURIComponent;b.forEach(d,function(a){if(a.length){var d=a.split("="),f=e(d.shift()),g=e(d.join("="));typeof c[f]=="string"&&(c[f]=[c[f]]),b.isArray(c[f])?c[f].push(g):c[f]=g}});return c},a._blockAsync=!1;var e=b._contentHandlers=a.contentHandlers={text:function(a){return a.responseText},json:function(a){return b.fromJson(a.responseText||null)},"json-comment-filtered":function(c){a.config.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}&&\nUse djConfig.useCommentedJson=true to turn off this message.");var d=c.responseText,e=d.indexOf("/*"),f=d.lastIndexOf("*/");if(e==-1||f==-1)throw new Error("JSON was not comment filtered");return b.fromJson(d.substring(e+2,f))},javascript:function(a){return b.eval(a.responseText)},xml:function(a){var c=a.responseXML;if(b.isIE&&(!c||!c.documentElement)){var d=function(a){return"MSXML"+a+".DOMDocument"},e=["Microsoft.XMLDOM",d(6),d(4),d(3),d(2)];b.some(e,function(b){try{var d=new ActiveXObject(b);d.async=!1,d.loadXML(a.responseText),c=d}catch(e){return!1}return!0})}return c},"json-comment-optional":function(a){return a.responseText&&/^[^{\[]*\/\*/.test(a.responseText)?e["json-comment-filtered"](a):e.json(a)}};a._ioSetArgs=function(a,d,e,f){var g={args:a,url:a.url},h=null;if(a.form){var i=b.byId(a.form),j=i.getAttributeNode("action");g.url=g.url||(j?j.value:null),h=b.formToObject(i)}var k=[{}];h&&k.push(h),a.content&&k.push(a.content),a.preventCache&&k.push({"dojo.preventCache":(new Date).valueOf()}),g.query=b.objectToQuery(b.mixin.apply(null,k)),g.handleAs=a.handleAs||"text";var l=new b.Deferred(d);l.addCallbacks(e,function(a){return f(a,l)});var m=a.load;m&&b.isFunction(m)&&l.addCallback(function(b){return m.call(a,b,g)});var n=a.error;n&&b.isFunction(n)&&l.addErrback(function(b){return n.call(a,b,g)});var o=a.handle;o&&b.isFunction(o)&&l.addBoth(function(b){return o.call(a,b,g)}),c.ioPublish&&b.publish&&g.args.ioPublish!==!1&&(l.addCallbacks(function(a){b.publish("/dojo/io/load",[l,a]);return a},function(a){b.publish("/dojo/io/error",[l,a]);return a}),l.addBoth(function(a){b.publish("/dojo/io/done",[l,a]);return a})),l.ioArgs=g;return l};var f=function(a){a.canceled=!0;var b=a.ioArgs.xhr,c=typeof b.abort;(c=="function"||c=="object"||c=="unknown")&&b.abort();var d=a.ioArgs.error;d||(d=new Error("xhr cancelled"),d.dojoType="cancel");return d},g=function(a){var b=e[a.ioArgs.handleAs](a.ioArgs.xhr);return b===undefined?null:b},h=function(a,b){b.ioArgs.args.failOk||console.error(a);return a},i=null,j=[],k=0,l=function(a){k<=0&&(k=0,c.ioPublish&&b.publish&&(!a||a&&a.ioArgs.args.ioPublish!==!1)&&b.publish("/dojo/io/stop"))},m=function(){var c=(new Date).getTime();if(!b._blockAsync)for(var d=0,e;d<j.length&&(e=j[d]);d++){var f=e.dfd,g=function(){if(f&&!f.canceled&&e.validCheck(f)){if(e.ioCheck(f))j.splice(d--,1),e.resHandle(f),k-=1;else if(f.startTime)if(f.startTime+(f.ioArgs.args.timeout||0)<c){j.splice(d--,1);var a=new Error("timeout exceeded");a.dojoType="timeout",f.errback(a),f.cancel(),k-=1}}else j.splice(d--,1),k-=1};if(a.config.debugAtAllCosts)g.call(this);else try{g.call(this)}catch(h){f.errback(h)}}l(f);j.length||(clearInterval(i),i=null)};a._ioCancelAll=function(){try{b.forEach(j,function(a){try{a.dfd.cancel()}catch(b){}})}catch(a){}},b.isIE&&b.addOnWindowUnload(b._ioCancelAll),b._ioNotifyStart=function(a){c.ioPublish&&b.publish&&a.ioArgs.args.ioPublish!==!1&&(k||b.publish("/dojo/io/start"),k+=1,b.publish("/dojo/io/send",[a]))},b._ioWatch=function(a,b,c,d){var e=a.ioArgs.args;e.timeout&&(a.startTime=(new Date).getTime()),j.push({dfd:a,validCheck:b,ioCheck:c,resHandle:d}),i||(i=setInterval(m,50)),e.sync&&m()};var n="application/x-www-form-urlencoded",o=function(a){return a.ioArgs.xhr.readyState},p=function(a){return 4==a.ioArgs.xhr.readyState},q=function(a){var c=a.ioArgs.xhr;if(b._isDocumentOk(c))a.callback(a);else{var d=new Error("Unable to load "+a.ioArgs.url+" status:"+c.status);d.status=c.status,d.responseText=c.responseText,a.errback(d)}};a._ioAddQueryToUrl=function(a){a.query.length&&(a.url+=(a.url.indexOf("?")==-1?"?":"&")+a.query,a.query=null)},a.xhr=function(c,d,e){var i=b._ioSetArgs(d,f,g,h),j=i.ioArgs,k=j.xhr=b._xhrObj(j.args);if(!k){i.cancel();return i}"postData"in d?j.query=d.postData:"putData"in d?j.query=d.putData:"rawBody"in d?j.query=d.rawBody:(arguments.length>2&&!e||"POST|PUT".indexOf(c.toUpperCase())==-1)&&b._ioAddQueryToUrl(j),k.open(c,j.url,d.sync!==!0,d.user||undefined,d.password||undefined);if(d.headers)for(var l in d.headers)l.toLowerCase()!=="content-type"||d.contentType?d.headers[l]&&k.setRequestHeader(l,d.headers[l]):d.contentType=d.headers[l];k.setRequestHeader("Content-Type",d.contentType||n),(!d.headers||!("X-Requested-With"in d.headers))&&k.setRequestHeader("X-Requested-With","XMLHttpRequest"),b._ioNotifyStart(i);if(a.config.debugAtAllCosts)k.send(j.query);else try{k.send(j.query)}catch(m){j.error=m,i.cancel()}b._ioWatch(i,o,p,q),k=null;return i},a.xhrGet=function(a){return b.xhr("GET",a)},a.rawXhrPost=a.xhrPost=function(a){return b.xhr("POST",a,!0)},a.rawXhrPut=a.xhrPut=function(a){return b.xhr("PUT",a,!0)},a.xhrDelete=function(a){return b.xhr("DELETE",a)}})();return a.xhr})